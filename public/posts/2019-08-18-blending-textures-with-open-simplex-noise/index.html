<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A Processing implementation that combines Open Simplex Noise with image blending techniques to create smooth, organic animations of texture transitions.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://trimad.github.io/posts/2019-08-18-blending-textures-with-open-simplex-noise/">
    
    <title>Blending Textures With Open Simplex Noise | Ghostfeed</title>

    
    <link rel="stylesheet" href="https://trimad.github.io/css/style.css">

    <link href="https://trimad.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Ghostfeed" />
    <link href="https://trimad.github.io/index.xml" rel="feed" type="application/rss+xml" title="Ghostfeed" />
</head>
<body class="page">

    
    <div class="container">

        
        <div class="nav-left">
            <nav>
                
                    <section>
    <h2>Sections</h2>
    <ul>
        <li><a href="https://trimad.github.io/">Home</a></li>
        
        <li><a href="https://trimad.github.io/posts/">Posts</a></li>
        
        <li><a href="https://trimad.github.io/archive/">Archive</a></li>
        
    </ul>
</section>

<section>
    <h2>BTC</h2>
    <div class="qr-code-container">
        <img src="https://trimad.github.io/images/BTC.svg" alt="Bitcoin QR Code">
    </div>
</section>
                
            </nav>
        </div>

        <div class="recent-activity">
            <nav>
                
                <section>
    <h2>Recent Activity</h2>
    <ul>
        
        <li><a href="https://trimad.github.io/posts/2025-07-02-videos-as-teams-backgrounds/">Videos as Teams Backgrounds</a></li>
        
        <li><a href="https://trimad.github.io/posts/2021-09-16-manage-exchange-online-calendars/">Managing Exchange Calendars</a></li>
        
        <li><a href="https://trimad.github.io/posts/2024-07-30-batch-compress-images/">Automated Batch Image Compression with Python</a></li>
        
        <li><a href="https://trimad.github.io/posts/2025-06-17-udm-arguments/">UDM Parameters for Google Search</a></li>
        
        <li><a href="https://trimad.github.io/posts/2024-01-02-take-control/">Troubleshooting N-Central Take Control</a></li>
        
        <li><a href="https://trimad.github.io/posts/2025-05-02-procdump-and-windbg/">Troubleshoot Crashing Apps with ProcDump &amp; WinDbg</a></li>
        
        <li><a href="https://trimad.github.io/posts/2016-12-13-arrays/">Interactive Array Visualization</a></li>
        
        <li><a href="https://trimad.github.io/posts/2017-07-16-simple-2d-perlin-noise/"></a></li>
        
        <li><a href="https://trimad.github.io/posts/2017-07-18-counting-sort/"></a></li>
        
        <li><a href="https://trimad.github.io/posts/2017-10-07-nth-fibonacci-number/">Nth Fibonacci Number</a></li>
        
    </ul>
</section>
                
            </nav>
        </div>
        
        
        <nav class="search">
            <input
            type="search"
                id="post-search"
                placeholder="Search posts…"
                aria-label="Search posts">
        </nav>

        
        <main>
            
<article class="post">
    <header>
        <h2>Blending Textures With Open Simplex Noise</h2>
        <p>
            Published: August 18, 2019
            
            
            | Last Modified: May 13, 2025
            
            
        </p>
        
        <p>Tags:
            
            <a href="https://trimad.github.io/%20/tags/animation">animation</a>
            
            <a href="https://trimad.github.io/%20/tags/open-simplex-noise">open simplex noise</a>
            
        </p>
        
        
        <p>Categories:
            
            <a href="https://trimad.github.io/%20/categories/java">Java</a>
            
            <a href="https://trimad.github.io/%20/categories/processing">Processing</a>
            
        </p>
        
    </header>
    <section>
        
        <p>This Processing sketch loads two images and creates an image mask that blends them together. The transparency of the image mask is determined by 4D Open Simplex Noise, which loops perfectly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>PImage img1;
</span></span><span style="display:flex;"><span>PImage img2;
</span></span><span style="display:flex;"><span>PImage imgMask;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> totalFrames <span style="color:#f92672">=</span> 60;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">boolean</span> record <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">float</span> increment <span style="color:#f92672">=</span> 0.<span style="color:#a6e22e">008</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Just for non-looping demo</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">float</span> zoff <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OpenSimplexNoise noise;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>() {
</span></span><span style="display:flex;"><span>  size(512, 512);
</span></span><span style="display:flex;"><span>  img1 <span style="color:#f92672">=</span> loadImage(<span style="color:#e6db74">&#34;textures/texture01.jpg&#34;</span>);
</span></span><span style="display:flex;"><span>  img1.<span style="color:#a6e22e">resize</span>(width, height);
</span></span><span style="display:flex;"><span>  img2 <span style="color:#f92672">=</span> loadImage(<span style="color:#e6db74">&#34;textures/texture02.jpg&#34;</span>);
</span></span><span style="display:flex;"><span>  img2.<span style="color:#a6e22e">resize</span>(width, height);
</span></span><span style="display:flex;"><span>  imgMask <span style="color:#f92672">=</span> createImage(width, height, ALPHA);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  noise <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> OpenSimplexNoise();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">draw</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> percent <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (record) {
</span></span><span style="display:flex;"><span>    percent <span style="color:#f92672">=</span> <span style="color:#66d9ef">float</span>(frameCount) <span style="color:#f92672">/</span> totalFrames;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    percent <span style="color:#f92672">=</span> <span style="color:#66d9ef">float</span>(frameCount <span style="color:#f92672">%</span> totalFrames) <span style="color:#f92672">/</span> totalFrames;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  render(percent);
</span></span><span style="display:flex;"><span>  image(img2, 0, 0);
</span></span><span style="display:flex;"><span>  img1.<span style="color:#a6e22e">mask</span>(imgMask);
</span></span><span style="display:flex;"><span>  image(img1, 0, 0);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (record) {
</span></span><span style="display:flex;"><span>    saveFrame(<span style="color:#e6db74">&#34;output/gif-&#34;</span><span style="color:#f92672">+</span>nf(frameCount, 3)<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;.png&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (frameCount <span style="color:#f92672">==</span> totalFrames) {
</span></span><span style="display:flex;"><span>      exit();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">render</span>(<span style="color:#66d9ef">float</span> percent) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> angle <span style="color:#f92672">=</span> map(percent, 0, 1, 0, TWO_PI);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> uoff <span style="color:#f92672">=</span> map(sin(angle), <span style="color:#f92672">-</span>1, 1, 0, 1);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> voff <span style="color:#f92672">=</span> map(cos(angle), <span style="color:#f92672">-</span>1, 1, 0, 1);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> xoff <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  imgMask.<span style="color:#a6e22e">loadPixels</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> 0; x <span style="color:#f92672">&lt;</span> width; x<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> yoff <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> 0; y <span style="color:#f92672">&lt;</span> height; y<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">float</span> n;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (record) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 4D Open Simplex Noise is very slow!</span>
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> (<span style="color:#66d9ef">float</span>) noise.<span style="color:#a6e22e">eval</span>(xoff, yoff, uoff, voff);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// If you aren&#39;t worried about looping run this instead for speed!</span>
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> (<span style="color:#66d9ef">float</span>) noise.<span style="color:#a6e22e">eval</span>(xoff, yoff, zoff);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">float</span> bright <span style="color:#f92672">=</span> map(n, 0, 1, 0, 255);
</span></span><span style="display:flex;"><span>      imgMask.<span style="color:#a6e22e">pixels</span><span style="color:#f92672">[</span>x <span style="color:#f92672">+</span> y <span style="color:#f92672">*</span> width<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> color(bright);
</span></span><span style="display:flex;"><span>      yoff <span style="color:#f92672">+=</span> increment;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    xoff <span style="color:#f92672">+=</span> increment;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  imgMask.<span style="color:#a6e22e">updatePixels</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>record) {
</span></span><span style="display:flex;"><span>    zoff <span style="color:#f92672">+=</span> increment;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3><a href="https://github.com/KdotJPG/OpenSimplex2">GitHub repository for the OpenSimplexNoise class</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * OpenSimplex Noise in Java.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * by Kurt Spencer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * v1.1 (October 5, 2014)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * - Added 2D and 4D implementations.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * - Proper gradient sets for all dimensions, from a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *   dimensionally-generalizable scheme with an actual
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *   rhyme and reason behind it.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * - Removed default permutation array in favor of
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *   default seed.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * - Changed seed-based constructor to be independent
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *   of any particular randomization library, so results
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> *   will be the same when ported to other languages.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OpenSimplexNoise</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">double</span> STRETCH_CONSTANT_2D <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>0.<span style="color:#a6e22e">211324865405187</span>;    <span style="color:#75715e">//(1/Math.sqrt(2+1)-1)/2;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">double</span> SQUISH_CONSTANT_2D <span style="color:#f92672">=</span> 0.<span style="color:#a6e22e">366025403784439</span>;      <span style="color:#75715e">//(Math.sqrt(2+1)-1)/2;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">double</span> STRETCH_CONSTANT_3D <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1.<span style="color:#a6e22e">0</span> <span style="color:#f92672">/</span> 6;              <span style="color:#75715e">//(1/Math.sqrt(3+1)-1)/3;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">double</span> SQUISH_CONSTANT_3D <span style="color:#f92672">=</span> 1.<span style="color:#a6e22e">0</span> <span style="color:#f92672">/</span> 3;                <span style="color:#75715e">//(Math.sqrt(3+1)-1)/3;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">double</span> STRETCH_CONSTANT_4D <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>0.<span style="color:#a6e22e">138196601125011</span>;    <span style="color:#75715e">//(1/Math.sqrt(4+1)-1)/4;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">double</span> SQUISH_CONSTANT_4D <span style="color:#f92672">=</span> 0.<span style="color:#a6e22e">309016994374947</span>;      <span style="color:#75715e">//(Math.sqrt(4+1)-1)/4;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">double</span> NORM_CONSTANT_2D <span style="color:#f92672">=</span> 47;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">double</span> NORM_CONSTANT_3D <span style="color:#f92672">=</span> 103;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">double</span> NORM_CONSTANT_4D <span style="color:#f92672">=</span> 30;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> DEFAULT_SEED <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">short</span><span style="color:#f92672">[]</span> perm;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">short</span><span style="color:#f92672">[]</span> permGradIndex3D;
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">OpenSimplexNoise</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>(DEFAULT_SEED);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">OpenSimplexNoise</span>(<span style="color:#66d9ef">short</span><span style="color:#f92672">[]</span> perm) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">perm</span> <span style="color:#f92672">=</span> perm;
</span></span><span style="display:flex;"><span>    permGradIndex3D <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">short</span><span style="color:#f92672">[</span>256<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> 256; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Since 3D has 24 gradients, simple bitmask won&#39;t work, so precompute modulo array.</span>
</span></span><span style="display:flex;"><span>      permGradIndex3D<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">short</span>)((perm<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">%</span> (gradients3D.<span style="color:#a6e22e">length</span> <span style="color:#f92672">/</span> 3)) <span style="color:#f92672">*</span> 3);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//Initializes the class using a permutation array generated from a 64-bit seed.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//Generates a proper permutation (i.e. doesn&#39;t merely perform N successive pair swaps on a base array)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//Uses a simple 64-bit LCG.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">OpenSimplexNoise</span>(<span style="color:#66d9ef">long</span> seed) {
</span></span><span style="display:flex;"><span>    perm <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">short</span><span style="color:#f92672">[</span>256<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    permGradIndex3D <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">short</span><span style="color:#f92672">[</span>256<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">short</span><span style="color:#f92672">[]</span> source <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">short</span><span style="color:#f92672">[</span>256<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">short</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> 256; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>      source<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>    seed <span style="color:#f92672">=</span> seed <span style="color:#f92672">*</span> 6364136223846793005l <span style="color:#f92672">+</span> 1442695040888963407l;
</span></span><span style="display:flex;"><span>    seed <span style="color:#f92672">=</span> seed <span style="color:#f92672">*</span> 6364136223846793005l <span style="color:#f92672">+</span> 1442695040888963407l;
</span></span><span style="display:flex;"><span>    seed <span style="color:#f92672">=</span> seed <span style="color:#f92672">*</span> 6364136223846793005l <span style="color:#f92672">+</span> 1442695040888963407l;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 255; i <span style="color:#f92672">&gt;=</span> 0; i<span style="color:#f92672">--</span>) {
</span></span><span style="display:flex;"><span>      seed <span style="color:#f92672">=</span> seed <span style="color:#f92672">*</span> 6364136223846793005l <span style="color:#f92672">+</span> 1442695040888963407l;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> r <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span>)((seed <span style="color:#f92672">+</span> 31) <span style="color:#f92672">%</span> (i <span style="color:#f92672">+</span> 1));
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (r <span style="color:#f92672">&lt;</span> 0)
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">+=</span> (i <span style="color:#f92672">+</span> 1);
</span></span><span style="display:flex;"><span>      perm<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> source<span style="color:#f92672">[</span>r<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>      permGradIndex3D<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">short</span>)((perm<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">%</span> (gradients3D.<span style="color:#a6e22e">length</span> <span style="color:#f92672">/</span> 3)) <span style="color:#f92672">*</span> 3);
</span></span><span style="display:flex;"><span>      source<span style="color:#f92672">[</span>r<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> source<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//2D OpenSimplex Noise.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">eval</span>(<span style="color:#66d9ef">double</span> x, <span style="color:#66d9ef">double</span> y) {
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Place input coordinates onto grid.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> stretchOffset <span style="color:#f92672">=</span> (x <span style="color:#f92672">+</span> y) <span style="color:#f92672">*</span> STRETCH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> xs <span style="color:#f92672">=</span> x <span style="color:#f92672">+</span> stretchOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> ys <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> stretchOffset;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Floor to get grid coordinates of rhombus (stretched square) super-cell origin.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xsb <span style="color:#f92672">=</span> fastFloor(xs);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> ysb <span style="color:#f92672">=</span> fastFloor(ys);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Skew out to get actual coordinates of rhombus origin. We&#39;ll need these later.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> squishOffset <span style="color:#f92672">=</span> (xsb <span style="color:#f92672">+</span> ysb) <span style="color:#f92672">*</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> xb <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> squishOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> yb <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> squishOffset;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Compute grid coordinates relative to rhombus origin.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> xins <span style="color:#f92672">=</span> xs <span style="color:#f92672">-</span> xsb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> yins <span style="color:#f92672">=</span> ys <span style="color:#f92672">-</span> ysb;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Sum those together to get a value that determines which region we&#39;re in.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> inSum <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> yins;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Positions relative to origin point.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx0 <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> xb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dy0 <span style="color:#f92672">=</span> y <span style="color:#f92672">-</span> yb;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//We&#39;ll be defining these inside the next block and using them afterwards.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx_ext, dy_ext;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xsv_ext, ysv_ext;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> value <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Contribution (1,0)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dy1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> attn1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx1 <span style="color:#f92672">*</span> dx1 <span style="color:#f92672">-</span> dy1 <span style="color:#f92672">*</span> dy1;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (attn1 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>      attn1 <span style="color:#f92672">*=</span> attn1;
</span></span><span style="display:flex;"><span>      value <span style="color:#f92672">+=</span> attn1 <span style="color:#f92672">*</span> attn1 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, dx1, dy1);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Contribution (0,1)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dy2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> attn2 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx2 <span style="color:#f92672">*</span> dx2 <span style="color:#f92672">-</span> dy2 <span style="color:#f92672">*</span> dy2;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (attn2 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>      attn2 <span style="color:#f92672">*=</span> attn2;
</span></span><span style="display:flex;"><span>      value <span style="color:#f92672">+=</span> attn2 <span style="color:#f92672">*</span> attn2 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, dx2, dy2);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (inSum <span style="color:#f92672">&lt;=</span> 1) { <span style="color:#75715e">//We&#39;re inside the triangle (2-Simplex) at (0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> zins <span style="color:#f92672">=</span> 1 <span style="color:#f92672">-</span> inSum;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (zins <span style="color:#f92672">&gt;</span> xins <span style="color:#f92672">||</span> zins <span style="color:#f92672">&gt;</span> yins) { <span style="color:#75715e">//(0,0) is one of the closest two triangular vertices</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (xins <span style="color:#f92672">&gt;</span> yins) {
</span></span><span style="display:flex;"><span>          xsv_ext <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          ysv_ext <span style="color:#f92672">=</span> ysb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext <span style="color:#f92672">=</span> xsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          ysv_ext <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//(1,0) and (0,1) are the closest two vertices.</span>
</span></span><span style="display:flex;"><span>        xsv_ext <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        ysv_ext <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        dx_ext <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>        dy_ext <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//We&#39;re inside the triangle (2-Simplex) at (1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> zins <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> inSum;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (zins <span style="color:#f92672">&lt;</span> xins <span style="color:#f92672">||</span> zins <span style="color:#f92672">&lt;</span> yins) { <span style="color:#75715e">//(0,0) is one of the closest two triangular vertices</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (xins <span style="color:#f92672">&gt;</span> yins) {
</span></span><span style="display:flex;"><span>          xsv_ext <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          ysv_ext <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 0;
</span></span><span style="display:flex;"><span>          dx_ext <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>          dy_ext <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">+</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 0;
</span></span><span style="display:flex;"><span>          ysv_ext <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          dx_ext <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>          dy_ext <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//(1,0) and (0,1) are the closest two vertices.</span>
</span></span><span style="display:flex;"><span>        dx_ext <span style="color:#f92672">=</span> dx0;
</span></span><span style="display:flex;"><span>        dy_ext <span style="color:#f92672">=</span> dy0;
</span></span><span style="display:flex;"><span>        xsv_ext <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>        ysv_ext <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      xsb <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>      ysb <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>      dx0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>      dy0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_2D;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Contribution (0,0) or (1,1)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> attn0 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx0 <span style="color:#f92672">*</span> dx0 <span style="color:#f92672">-</span> dy0 <span style="color:#f92672">*</span> dy0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (attn0 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>      attn0 <span style="color:#f92672">*=</span> attn0;
</span></span><span style="display:flex;"><span>      value <span style="color:#f92672">+=</span> attn0 <span style="color:#f92672">*</span> attn0 <span style="color:#f92672">*</span> extrapolate(xsb, ysb, dx0, dy0);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Extra Vertex</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> attn_ext <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx_ext <span style="color:#f92672">*</span> dx_ext <span style="color:#f92672">-</span> dy_ext <span style="color:#f92672">*</span> dy_ext;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (attn_ext <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>      attn_ext <span style="color:#f92672">*=</span> attn_ext;
</span></span><span style="display:flex;"><span>      value <span style="color:#f92672">+=</span> attn_ext <span style="color:#f92672">*</span> attn_ext <span style="color:#f92672">*</span> extrapolate(xsv_ext, ysv_ext, dx_ext, dy_ext);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> value <span style="color:#f92672">/</span> NORM_CONSTANT_2D;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//3D OpenSimplex Noise.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">eval</span>(<span style="color:#66d9ef">double</span> x, <span style="color:#66d9ef">double</span> y, <span style="color:#66d9ef">double</span> z) {
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Place input coordinates on simplectic honeycomb.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> stretchOffset <span style="color:#f92672">=</span> (x <span style="color:#f92672">+</span> y <span style="color:#f92672">+</span> z) <span style="color:#f92672">*</span> STRETCH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> xs <span style="color:#f92672">=</span> x <span style="color:#f92672">+</span> stretchOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> ys <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> stretchOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> zs <span style="color:#f92672">=</span> z <span style="color:#f92672">+</span> stretchOffset;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Floor to get simplectic honeycomb coordinates of rhombohedron (stretched cube) super-cell origin.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xsb <span style="color:#f92672">=</span> fastFloor(xs);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> ysb <span style="color:#f92672">=</span> fastFloor(ys);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> zsb <span style="color:#f92672">=</span> fastFloor(zs);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Skew out to get actual coordinates of rhombohedron origin. We&#39;ll need these later.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> squishOffset <span style="color:#f92672">=</span> (xsb <span style="color:#f92672">+</span> ysb <span style="color:#f92672">+</span> zsb) <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> xb <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> squishOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> yb <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> squishOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> zb <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> squishOffset;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Compute simplectic honeycomb coordinates relative to rhombohedral origin.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> xins <span style="color:#f92672">=</span> xs <span style="color:#f92672">-</span> xsb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> yins <span style="color:#f92672">=</span> ys <span style="color:#f92672">-</span> ysb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> zins <span style="color:#f92672">=</span> zs <span style="color:#f92672">-</span> zsb;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Sum those together to get a value that determines which region we&#39;re in.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> inSum <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> yins <span style="color:#f92672">+</span> zins;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Positions relative to origin point.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx0 <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> xb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dy0 <span style="color:#f92672">=</span> y <span style="color:#f92672">-</span> yb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dz0 <span style="color:#f92672">=</span> z <span style="color:#f92672">-</span> zb;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//We&#39;ll be defining these inside the next block and using them afterwards.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx_ext0, dy_ext0, dz_ext0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx_ext1, dy_ext1, dz_ext1;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xsv_ext0, ysv_ext0, zsv_ext0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xsv_ext1, ysv_ext1, zsv_ext1;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> value <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (inSum <span style="color:#f92672">&lt;=</span> 1) { <span style="color:#75715e">//We&#39;re inside the tetrahedron (3-Simplex) at (0,0,0)</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Determine which two of (0,0,1), (0,1,0), (1,0,0) are closest.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> aPoint <span style="color:#f92672">=</span> 0x01;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> aScore <span style="color:#f92672">=</span> xins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> bPoint <span style="color:#f92672">=</span> 0x02;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> bScore <span style="color:#f92672">=</span> yins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> zins <span style="color:#f92672">&gt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> zins;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x04;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> zins <span style="color:#f92672">&gt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> zins;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x04;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Now we determine the two lattice points not part of the tetrahedron that may contribute.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//This depends on the closest two tetrahedral vertices, including (0,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> wins <span style="color:#f92672">=</span> 1 <span style="color:#f92672">-</span> inSum;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (wins <span style="color:#f92672">&gt;</span> aScore <span style="color:#f92672">||</span> wins <span style="color:#f92672">&gt;</span> bScore) { <span style="color:#75715e">//(0,0,0) is one of the closest two tetrahedral vertices.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (bScore <span style="color:#f92672">&gt;</span> aScore <span style="color:#f92672">?</span> bPoint : aPoint); <span style="color:#75715e">//Our other closest vertex is the closest out of a and b.</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//(0,0,0) is not one of the closest two tetrahedral vertices.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">|</span> bPoint); <span style="color:#75715e">//Our two extra vertices are determined by the closest two.</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn0 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx0 <span style="color:#f92672">*</span> dx0 <span style="color:#f92672">-</span> dy0 <span style="color:#f92672">*</span> dy0 <span style="color:#f92672">-</span> dz0 <span style="color:#f92672">*</span> dz0;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn0 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn0 <span style="color:#f92672">*=</span> attn0;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn0 <span style="color:#f92672">*</span> attn0 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 0, dx0, dy0, dz0);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx1 <span style="color:#f92672">*</span> dx1 <span style="color:#f92672">-</span> dy1 <span style="color:#f92672">*</span> dy1 <span style="color:#f92672">-</span> dz1 <span style="color:#f92672">*</span> dz1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn1 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn1 <span style="color:#f92672">*=</span> attn1;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn1 <span style="color:#f92672">*</span> attn1 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 0, dx1, dy1, dz1);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz2 <span style="color:#f92672">=</span> dz1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn2 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx2 <span style="color:#f92672">*</span> dx2 <span style="color:#f92672">-</span> dy2 <span style="color:#f92672">*</span> dy2 <span style="color:#f92672">-</span> dz2 <span style="color:#f92672">*</span> dz2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn2 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn2 <span style="color:#f92672">*=</span> attn2;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn2 <span style="color:#f92672">*</span> attn2 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, dx2, dy2, dz2);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx3 <span style="color:#f92672">=</span> dx2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy3 <span style="color:#f92672">=</span> dy1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz3 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn3 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx3 <span style="color:#f92672">*</span> dx3 <span style="color:#f92672">-</span> dy3 <span style="color:#f92672">*</span> dy3 <span style="color:#f92672">-</span> dz3 <span style="color:#f92672">*</span> dz3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn3 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn3 <span style="color:#f92672">*=</span> attn3;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn3 <span style="color:#f92672">*</span> attn3 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, dx3, dy3, dz3);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (inSum <span style="color:#f92672">&gt;=</span> 2) { <span style="color:#75715e">//We&#39;re inside the tetrahedron (3-Simplex) at (1,1,1)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Determine which two tetrahedral vertices are the closest, out of (1,1,0), (1,0,1), (0,1,1) but not (1,1,1).</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> aPoint <span style="color:#f92672">=</span> 0x06;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> aScore <span style="color:#f92672">=</span> xins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> bPoint <span style="color:#f92672">=</span> 0x05;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> bScore <span style="color:#f92672">=</span> yins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> zins <span style="color:#f92672">&lt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> zins;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x03;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> zins <span style="color:#f92672">&lt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> zins;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x03;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Now we determine the two lattice points not part of the tetrahedron that may contribute.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//This depends on the closest two tetrahedral vertices, including (1,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> wins <span style="color:#f92672">=</span> 3 <span style="color:#f92672">-</span> inSum;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (wins <span style="color:#f92672">&lt;</span> aScore <span style="color:#f92672">||</span> wins <span style="color:#f92672">&lt;</span> bScore) { <span style="color:#75715e">//(1,1,1) is one of the closest two tetrahedral vertices.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (bScore <span style="color:#f92672">&lt;</span> aScore <span style="color:#f92672">?</span> bPoint : aPoint); <span style="color:#75715e">//Our other closest vertex is the closest out of a and b.</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//(1,1,1) is not one of the closest two tetrahedral vertices.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">&amp;</span> bPoint); <span style="color:#75715e">//Our two extra vertices are determined by the closest two.</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx3 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy3 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz3 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn3 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx3 <span style="color:#f92672">*</span> dx3 <span style="color:#f92672">-</span> dy3 <span style="color:#f92672">*</span> dy3 <span style="color:#f92672">-</span> dz3 <span style="color:#f92672">*</span> dz3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn3 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn3 <span style="color:#f92672">*=</span> attn3;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn3 <span style="color:#f92672">*</span> attn3 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, dx3, dy3, dz3);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx2 <span style="color:#f92672">=</span> dx3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn2 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx2 <span style="color:#f92672">*</span> dx2 <span style="color:#f92672">-</span> dy2 <span style="color:#f92672">*</span> dy2 <span style="color:#f92672">-</span> dz2 <span style="color:#f92672">*</span> dz2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn2 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn2 <span style="color:#f92672">*=</span> attn2;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn2 <span style="color:#f92672">*</span> attn2 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, dx2, dy2, dz2);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy1 <span style="color:#f92672">=</span> dy3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz1 <span style="color:#f92672">=</span> dz2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx1 <span style="color:#f92672">*</span> dx1 <span style="color:#f92672">-</span> dy1 <span style="color:#f92672">*</span> dy1 <span style="color:#f92672">-</span> dz1 <span style="color:#f92672">*</span> dz1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn1 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn1 <span style="color:#f92672">*=</span> attn1;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn1 <span style="color:#f92672">*</span> attn1 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 1, dx1, dy1, dz1);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,1,1)</span>
</span></span><span style="display:flex;"><span>      dx0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      dy0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      dz0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn0 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx0 <span style="color:#f92672">*</span> dx0 <span style="color:#f92672">-</span> dy0 <span style="color:#f92672">*</span> dy0 <span style="color:#f92672">-</span> dz0 <span style="color:#f92672">*</span> dz0;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn0 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn0 <span style="color:#f92672">*=</span> attn0;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn0 <span style="color:#f92672">*</span> attn0 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 1, dx0, dy0, dz0);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//We&#39;re inside the octahedron (Rectified 3-Simplex) in between.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> aScore;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> aPoint;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">boolean</span> aIsFurtherSide;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> bScore;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> bPoint;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">boolean</span> bIsFurtherSide;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide between point (0,0,1) and (1,1,0) as closest</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p1 <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> yins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (p1 <span style="color:#f92672">&gt;</span> 1) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> p1 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x03;
</span></span><span style="display:flex;"><span>        aIsFurtherSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> 1 <span style="color:#f92672">-</span> p1;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x04;
</span></span><span style="display:flex;"><span>        aIsFurtherSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide between point (0,1,0) and (1,0,1) as closest</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p2 <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> zins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (p2 <span style="color:#f92672">&gt;</span> 1) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> p2 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x05;
</span></span><span style="display:flex;"><span>        bIsFurtherSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> 1 <span style="color:#f92672">-</span> p2;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x02;
</span></span><span style="display:flex;"><span>        bIsFurtherSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//The closest out of the two (1,0,0) and (0,1,1) will replace the furthest out of the two decided above, if closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p3 <span style="color:#f92672">=</span> yins <span style="color:#f92672">+</span> zins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (p3 <span style="color:#f92672">&gt;</span> 1) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> score <span style="color:#f92672">=</span> p3 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> aScore <span style="color:#f92672">&lt;</span> score) {
</span></span><span style="display:flex;"><span>          aScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          aPoint <span style="color:#f92672">=</span> 0x06;
</span></span><span style="display:flex;"><span>          aIsFurtherSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> bScore <span style="color:#f92672">&lt;</span> score) {
</span></span><span style="display:flex;"><span>          bScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          bPoint <span style="color:#f92672">=</span> 0x06;
</span></span><span style="display:flex;"><span>          bIsFurtherSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> score <span style="color:#f92672">=</span> 1 <span style="color:#f92672">-</span> p3;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> aScore <span style="color:#f92672">&lt;</span> score) {
</span></span><span style="display:flex;"><span>          aScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          aPoint <span style="color:#f92672">=</span> 0x01;
</span></span><span style="display:flex;"><span>          aIsFurtherSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> bScore <span style="color:#f92672">&lt;</span> score) {
</span></span><span style="display:flex;"><span>          bScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          bPoint <span style="color:#f92672">=</span> 0x01;
</span></span><span style="display:flex;"><span>          bIsFurtherSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Where each of the two closest points are determines how the extra two vertices are calculated.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aIsFurtherSide <span style="color:#f92672">==</span> bIsFurtherSide) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aIsFurtherSide) { <span style="color:#75715e">//Both closest points on (1,1,1) side</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//One of the two extra points is (1,1,1)</span>
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//Other extra point is based on the shared axis.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">&amp;</span> bPoint);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {<span style="color:#75715e">//Both closest points on (0,0,0) side</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//One of the two extra points is (0,0,0)</span>
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0;
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//Other extra point is based on the omitted axis.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">|</span> bPoint);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>            xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//One point on (0,0,0) side, one point on (1,1,1) side</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c1, c2;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aIsFurtherSide) {
</span></span><span style="display:flex;"><span>          c1 <span style="color:#f92672">=</span> aPoint;
</span></span><span style="display:flex;"><span>          c2 <span style="color:#f92672">=</span> bPoint;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          c1 <span style="color:#f92672">=</span> bPoint;
</span></span><span style="display:flex;"><span>          c2 <span style="color:#f92672">=</span> aPoint;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//One contribution is a permutation of (1,1,-1)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//One contribution is a permutation of (0,0,2)</span>
</span></span><span style="display:flex;"><span>        dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>        xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>        ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>        zsv_ext1 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          dy_ext1 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          ysv_ext1 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          zsv_ext1 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx1 <span style="color:#f92672">*</span> dx1 <span style="color:#f92672">-</span> dy1 <span style="color:#f92672">*</span> dy1 <span style="color:#f92672">-</span> dz1 <span style="color:#f92672">*</span> dz1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn1 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn1 <span style="color:#f92672">*=</span> attn1;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn1 <span style="color:#f92672">*</span> attn1 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 0, dx1, dy1, dz1);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz2 <span style="color:#f92672">=</span> dz1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn2 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx2 <span style="color:#f92672">*</span> dx2 <span style="color:#f92672">-</span> dy2 <span style="color:#f92672">*</span> dy2 <span style="color:#f92672">-</span> dz2 <span style="color:#f92672">*</span> dz2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn2 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn2 <span style="color:#f92672">*=</span> attn2;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn2 <span style="color:#f92672">*</span> attn2 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, dx2, dy2, dz2);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx3 <span style="color:#f92672">=</span> dx2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy3 <span style="color:#f92672">=</span> dy1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz3 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn3 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx3 <span style="color:#f92672">*</span> dx3 <span style="color:#f92672">-</span> dy3 <span style="color:#f92672">*</span> dy3 <span style="color:#f92672">-</span> dz3 <span style="color:#f92672">*</span> dz3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn3 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn3 <span style="color:#f92672">*=</span> attn3;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn3 <span style="color:#f92672">*</span> attn3 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, dx3, dy3, dz3);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx4 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy4 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz4 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn4 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx4 <span style="color:#f92672">*</span> dx4 <span style="color:#f92672">-</span> dy4 <span style="color:#f92672">*</span> dy4 <span style="color:#f92672">-</span> dz4 <span style="color:#f92672">*</span> dz4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn4 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn4 <span style="color:#f92672">*=</span> attn4;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn4 <span style="color:#f92672">*</span> attn4 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, dx4, dy4, dz4);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx5 <span style="color:#f92672">=</span> dx4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy5 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz5 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn5 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx5 <span style="color:#f92672">*</span> dx5 <span style="color:#f92672">-</span> dy5 <span style="color:#f92672">*</span> dy5 <span style="color:#f92672">-</span> dz5 <span style="color:#f92672">*</span> dz5;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn5 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn5 <span style="color:#f92672">*=</span> attn5;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn5 <span style="color:#f92672">*</span> attn5 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, dx5, dy5, dz5);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx6 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_3D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy6 <span style="color:#f92672">=</span> dy4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz6 <span style="color:#f92672">=</span> dz5;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn6 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx6 <span style="color:#f92672">*</span> dx6 <span style="color:#f92672">-</span> dy6 <span style="color:#f92672">*</span> dy6 <span style="color:#f92672">-</span> dz6 <span style="color:#f92672">*</span> dz6;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn6 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn6 <span style="color:#f92672">*=</span> attn6;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn6 <span style="color:#f92672">*</span> attn6 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 1, dx6, dy6, dz6);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//First extra vertex</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> attn_ext0 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx_ext0 <span style="color:#f92672">*</span> dx_ext0 <span style="color:#f92672">-</span> dy_ext0 <span style="color:#f92672">*</span> dy_ext0 <span style="color:#f92672">-</span> dz_ext0 <span style="color:#f92672">*</span> dz_ext0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (attn_ext0 <span style="color:#f92672">&gt;</span> 0)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      attn_ext0 <span style="color:#f92672">*=</span> attn_ext0;
</span></span><span style="display:flex;"><span>      value <span style="color:#f92672">+=</span> attn_ext0 <span style="color:#f92672">*</span> attn_ext0 <span style="color:#f92672">*</span> extrapolate(xsv_ext0, ysv_ext0, zsv_ext0, dx_ext0, dy_ext0, dz_ext0);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Second extra vertex</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> attn_ext1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx_ext1 <span style="color:#f92672">*</span> dx_ext1 <span style="color:#f92672">-</span> dy_ext1 <span style="color:#f92672">*</span> dy_ext1 <span style="color:#f92672">-</span> dz_ext1 <span style="color:#f92672">*</span> dz_ext1;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (attn_ext1 <span style="color:#f92672">&gt;</span> 0)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      attn_ext1 <span style="color:#f92672">*=</span> attn_ext1;
</span></span><span style="display:flex;"><span>      value <span style="color:#f92672">+=</span> attn_ext1 <span style="color:#f92672">*</span> attn_ext1 <span style="color:#f92672">*</span> extrapolate(xsv_ext1, ysv_ext1, zsv_ext1, dx_ext1, dy_ext1, dz_ext1);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> value <span style="color:#f92672">/</span> NORM_CONSTANT_3D;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//4D OpenSimplex Noise.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">eval</span>(<span style="color:#66d9ef">double</span> x, <span style="color:#66d9ef">double</span> y, <span style="color:#66d9ef">double</span> z, <span style="color:#66d9ef">double</span> w) {
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Place input coordinates on simplectic honeycomb.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> stretchOffset <span style="color:#f92672">=</span> (x <span style="color:#f92672">+</span> y <span style="color:#f92672">+</span> z <span style="color:#f92672">+</span> w) <span style="color:#f92672">*</span> STRETCH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> xs <span style="color:#f92672">=</span> x <span style="color:#f92672">+</span> stretchOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> ys <span style="color:#f92672">=</span> y <span style="color:#f92672">+</span> stretchOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> zs <span style="color:#f92672">=</span> z <span style="color:#f92672">+</span> stretchOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> ws <span style="color:#f92672">=</span> w <span style="color:#f92672">+</span> stretchOffset;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Floor to get simplectic honeycomb coordinates of rhombo-hypercube super-cell origin.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xsb <span style="color:#f92672">=</span> fastFloor(xs);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> ysb <span style="color:#f92672">=</span> fastFloor(ys);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> zsb <span style="color:#f92672">=</span> fastFloor(zs);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> wsb <span style="color:#f92672">=</span> fastFloor(ws);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Skew out to get actual coordinates of stretched rhombo-hypercube origin. We&#39;ll need these later.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> squishOffset <span style="color:#f92672">=</span> (xsb <span style="color:#f92672">+</span> ysb <span style="color:#f92672">+</span> zsb <span style="color:#f92672">+</span> wsb) <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> xb <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> squishOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> yb <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> squishOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> zb <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> squishOffset;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> wb <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> squishOffset;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Compute simplectic honeycomb coordinates relative to rhombo-hypercube origin.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> xins <span style="color:#f92672">=</span> xs <span style="color:#f92672">-</span> xsb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> yins <span style="color:#f92672">=</span> ys <span style="color:#f92672">-</span> ysb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> zins <span style="color:#f92672">=</span> zs <span style="color:#f92672">-</span> zsb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> wins <span style="color:#f92672">=</span> ws <span style="color:#f92672">-</span> wsb;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Sum those together to get a value that determines which region we&#39;re in.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> inSum <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> yins <span style="color:#f92672">+</span> zins <span style="color:#f92672">+</span> wins;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Positions relative to origin point.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx0 <span style="color:#f92672">=</span> x <span style="color:#f92672">-</span> xb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dy0 <span style="color:#f92672">=</span> y <span style="color:#f92672">-</span> yb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dz0 <span style="color:#f92672">=</span> z <span style="color:#f92672">-</span> zb;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dw0 <span style="color:#f92672">=</span> w <span style="color:#f92672">-</span> wb;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//We&#39;ll be defining these inside the next block and using them afterwards.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx_ext0, dy_ext0, dz_ext0, dw_ext0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx_ext1, dy_ext1, dz_ext1, dw_ext1;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> dx_ext2, dy_ext2, dz_ext2, dw_ext2;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xsv_ext0, ysv_ext0, zsv_ext0, wsv_ext0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xsv_ext1, ysv_ext1, zsv_ext1, wsv_ext1;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xsv_ext2, ysv_ext2, zsv_ext2, wsv_ext2;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> value <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (inSum <span style="color:#f92672">&lt;=</span> 1) { <span style="color:#75715e">//We&#39;re inside the pentachoron (4-Simplex) at (0,0,0,0)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Determine which two of (0,0,0,1), (0,0,1,0), (0,1,0,0), (1,0,0,0) are closest.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> aPoint <span style="color:#f92672">=</span> 0x01;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> aScore <span style="color:#f92672">=</span> xins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> bPoint <span style="color:#f92672">=</span> 0x02;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> bScore <span style="color:#f92672">=</span> yins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> zins <span style="color:#f92672">&gt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> zins;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x04;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> zins <span style="color:#f92672">&gt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> zins;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x04;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> wins <span style="color:#f92672">&gt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> wins;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x08;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> wins <span style="color:#f92672">&gt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> wins;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x08;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Now we determine the three lattice points not part of the pentachoron that may contribute.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//This depends on the closest two pentachoron vertices, including (0,0,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> uins <span style="color:#f92672">=</span> 1 <span style="color:#f92672">-</span> inSum;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (uins <span style="color:#f92672">&gt;</span> aScore <span style="color:#f92672">||</span> uins <span style="color:#f92672">&gt;</span> bScore) { <span style="color:#75715e">//(0,0,0,0) is one of the closest two pentachoron vertices.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (bScore <span style="color:#f92672">&gt;</span> aScore <span style="color:#f92672">?</span> bPoint : aPoint); <span style="color:#75715e">//Our other closest vertex is the closest out of a and b.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">=</span> xsv_ext2 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx_ext2 <span style="color:#f92672">=</span> dx0;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsv_ext2 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx_ext1 <span style="color:#f92672">=</span> dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysv_ext2 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy_ext2 <span style="color:#f92672">=</span> dy0;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0x01) {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysv_ext2 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsv_ext2 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz_ext2 <span style="color:#f92672">=</span> dz0;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x03) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x03) <span style="color:#f92672">==</span> 0x03) {
</span></span><span style="display:flex;"><span>              zsv_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>              dz_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>              zsv_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>              dz_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            zsv_ext2 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext2 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsv_ext2 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x08) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>          wsv_ext2 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw_ext1 <span style="color:#f92672">=</span> dw0;
</span></span><span style="display:flex;"><span>          dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsv_ext2 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw_ext1 <span style="color:#f92672">=</span> dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//(0,0,0,0) is not one of the closest two pentachoron vertices.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">|</span> bPoint); <span style="color:#75715e">//Our three extra vertices are determined by the closest two.</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext2 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsv_ext2 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysv_ext2 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dy_ext1 <span style="color:#f92672">=</span> dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0x01) {
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext2 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext2 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysv_ext2 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dy_ext1 <span style="color:#f92672">=</span> dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsv_ext2 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x03) <span style="color:#f92672">==</span> 0x03) {
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            zsv_ext2 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext2 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsv_ext2 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x08) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>          wsv_ext2 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsv_ext2 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext1 <span style="color:#f92672">=</span> dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,0,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn0 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx0 <span style="color:#f92672">*</span> dx0 <span style="color:#f92672">-</span> dy0 <span style="color:#f92672">*</span> dy0 <span style="color:#f92672">-</span> dz0 <span style="color:#f92672">*</span> dz0 <span style="color:#f92672">-</span> dw0 <span style="color:#f92672">*</span> dw0;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn0 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn0 <span style="color:#f92672">*=</span> attn0;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn0 <span style="color:#f92672">*</span> attn0 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 0, dx0, dy0, dz0, dw0);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx1 <span style="color:#f92672">*</span> dx1 <span style="color:#f92672">-</span> dy1 <span style="color:#f92672">*</span> dy1 <span style="color:#f92672">-</span> dz1 <span style="color:#f92672">*</span> dz1 <span style="color:#f92672">-</span> dw1 <span style="color:#f92672">*</span> dw1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn1 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn1 <span style="color:#f92672">*=</span> attn1;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn1 <span style="color:#f92672">*</span> attn1 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 0, dx1, dy1, dz1, dw1);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz2 <span style="color:#f92672">=</span> dz1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw2 <span style="color:#f92672">=</span> dw1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn2 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx2 <span style="color:#f92672">*</span> dx2 <span style="color:#f92672">-</span> dy2 <span style="color:#f92672">*</span> dy2 <span style="color:#f92672">-</span> dz2 <span style="color:#f92672">*</span> dz2 <span style="color:#f92672">-</span> dw2 <span style="color:#f92672">*</span> dw2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn2 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn2 <span style="color:#f92672">*=</span> attn2;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn2 <span style="color:#f92672">*</span> attn2 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 0, dx2, dy2, dz2, dw2);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,0,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx3 <span style="color:#f92672">=</span> dx2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy3 <span style="color:#f92672">=</span> dy1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz3 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw3 <span style="color:#f92672">=</span> dw1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn3 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx3 <span style="color:#f92672">*</span> dx3 <span style="color:#f92672">-</span> dy3 <span style="color:#f92672">*</span> dy3 <span style="color:#f92672">-</span> dz3 <span style="color:#f92672">*</span> dz3 <span style="color:#f92672">-</span> dw3 <span style="color:#f92672">*</span> dw3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn3 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn3 <span style="color:#f92672">*=</span> attn3;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn3 <span style="color:#f92672">*</span> attn3 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 0, dx3, dy3, dz3, dw3);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,0,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx4 <span style="color:#f92672">=</span> dx2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy4 <span style="color:#f92672">=</span> dy1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz4 <span style="color:#f92672">=</span> dz1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw4 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn4 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx4 <span style="color:#f92672">*</span> dx4 <span style="color:#f92672">-</span> dy4 <span style="color:#f92672">*</span> dy4 <span style="color:#f92672">-</span> dz4 <span style="color:#f92672">*</span> dz4 <span style="color:#f92672">-</span> dw4 <span style="color:#f92672">*</span> dw4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn4 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn4 <span style="color:#f92672">*=</span> attn4;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn4 <span style="color:#f92672">*</span> attn4 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 1, dx4, dy4, dz4, dw4);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (inSum <span style="color:#f92672">&gt;=</span> 3) { <span style="color:#75715e">//We&#39;re inside the pentachoron (4-Simplex) at (1,1,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Determine which two of (1,1,1,0), (1,1,0,1), (1,0,1,1), (0,1,1,1) are closest.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> aPoint <span style="color:#f92672">=</span> 0x0E;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> aScore <span style="color:#f92672">=</span> xins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> bPoint <span style="color:#f92672">=</span> 0x0D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> bScore <span style="color:#f92672">=</span> yins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> zins <span style="color:#f92672">&lt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> zins;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x0B;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> zins <span style="color:#f92672">&lt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> zins;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x0B;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> wins <span style="color:#f92672">&lt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> wins;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x07;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> wins <span style="color:#f92672">&lt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> wins;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x07;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Now we determine the three lattice points not part of the pentachoron that may contribute.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//This depends on the closest two pentachoron vertices, including (0,0,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> uins <span style="color:#f92672">=</span> 4 <span style="color:#f92672">-</span> inSum;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (uins <span style="color:#f92672">&lt;</span> aScore <span style="color:#f92672">||</span> uins <span style="color:#f92672">&lt;</span> bScore) { <span style="color:#75715e">//(1,1,1,1) is one of the closest two pentachoron vertices.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (bScore <span style="color:#f92672">&lt;</span> aScore <span style="color:#f92672">?</span> bPoint : aPoint); <span style="color:#75715e">//Our other closest vertex is the closest out of a and b.</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">=</span> xsv_ext2 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsv_ext2 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx_ext1 <span style="color:#f92672">=</span> dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysv_ext2 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysv_ext2 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsv_ext2 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x03) <span style="color:#f92672">!=</span> 0x03) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x03) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>              zsv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>              dz_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>              zsv_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>              dz_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            zsv_ext2 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext2 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsv_ext2 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x08) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          wsv_ext2 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsv_ext2 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw_ext1 <span style="color:#f92672">=</span> dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//(1,1,1,1) is not one of the closest two pentachoron vertices.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">&amp;</span> bPoint); <span style="color:#75715e">//Our three extra vertices are determined by the closest two.</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext2 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsv_ext2 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysv_ext2 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dy_ext1 <span style="color:#f92672">=</span> dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext2 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext2 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysv_ext2 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dy_ext1 <span style="color:#f92672">=</span> dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsv_ext2 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x03) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            zsv_ext2 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext2 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsv_ext2 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x08) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          wsv_ext2 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsv_ext2 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext1 <span style="color:#f92672">=</span> dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,1,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx4 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy4 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz4 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw4 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn4 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx4 <span style="color:#f92672">*</span> dx4 <span style="color:#f92672">-</span> dy4 <span style="color:#f92672">*</span> dy4 <span style="color:#f92672">-</span> dz4 <span style="color:#f92672">*</span> dz4 <span style="color:#f92672">-</span> dw4 <span style="color:#f92672">*</span> dw4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn4 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn4 <span style="color:#f92672">*=</span> attn4;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn4 <span style="color:#f92672">*</span> attn4 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 0, dx4, dy4, dz4, dw4);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,1,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx3 <span style="color:#f92672">=</span> dx4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy3 <span style="color:#f92672">=</span> dy4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz3 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw3 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn3 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx3 <span style="color:#f92672">*</span> dx3 <span style="color:#f92672">-</span> dy3 <span style="color:#f92672">*</span> dy3 <span style="color:#f92672">-</span> dz3 <span style="color:#f92672">*</span> dz3 <span style="color:#f92672">-</span> dw3 <span style="color:#f92672">*</span> dw3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn3 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn3 <span style="color:#f92672">*=</span> attn3;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn3 <span style="color:#f92672">*</span> attn3 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 1, dx3, dy3, dz3, dw3);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx2 <span style="color:#f92672">=</span> dx4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz2 <span style="color:#f92672">=</span> dz4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw2 <span style="color:#f92672">=</span> dw3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn2 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx2 <span style="color:#f92672">*</span> dx2 <span style="color:#f92672">-</span> dy2 <span style="color:#f92672">*</span> dy2 <span style="color:#f92672">-</span> dz2 <span style="color:#f92672">*</span> dz2 <span style="color:#f92672">-</span> dw2 <span style="color:#f92672">*</span> dw2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn2 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn2 <span style="color:#f92672">*=</span> attn2;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn2 <span style="color:#f92672">*</span> attn2 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 1, dx2, dy2, dz2, dw2);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz1 <span style="color:#f92672">=</span> dz4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy1 <span style="color:#f92672">=</span> dy4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw1 <span style="color:#f92672">=</span> dw3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx1 <span style="color:#f92672">*</span> dx1 <span style="color:#f92672">-</span> dy1 <span style="color:#f92672">*</span> dy1 <span style="color:#f92672">-</span> dz1 <span style="color:#f92672">*</span> dz1 <span style="color:#f92672">-</span> dw1 <span style="color:#f92672">*</span> dw1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn1 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn1 <span style="color:#f92672">*=</span> attn1;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn1 <span style="color:#f92672">*</span> attn1 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 1, dx1, dy1, dz1, dw1);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,1,1,1)</span>
</span></span><span style="display:flex;"><span>      dx0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      dy0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      dz0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      dw0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn0 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx0 <span style="color:#f92672">*</span> dx0 <span style="color:#f92672">-</span> dy0 <span style="color:#f92672">*</span> dy0 <span style="color:#f92672">-</span> dz0 <span style="color:#f92672">*</span> dz0 <span style="color:#f92672">-</span> dw0 <span style="color:#f92672">*</span> dw0;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn0 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn0 <span style="color:#f92672">*=</span> attn0;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn0 <span style="color:#f92672">*</span> attn0 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 1, dx0, dy0, dz0, dw0);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (inSum <span style="color:#f92672">&lt;=</span> 2) { <span style="color:#75715e">//We&#39;re inside the first dispentachoron (Rectified 4-Simplex)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> aScore;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> aPoint;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">boolean</span> aIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> bScore;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> bPoint;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">boolean</span> bIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide between (1,1,0,0) and (0,0,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (xins <span style="color:#f92672">+</span> yins <span style="color:#f92672">&gt;</span> zins <span style="color:#f92672">+</span> wins) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> yins;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x03;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> zins <span style="color:#f92672">+</span> wins;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x0C;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide between (1,0,1,0) and (0,1,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (xins <span style="color:#f92672">+</span> zins <span style="color:#f92672">&gt;</span> yins <span style="color:#f92672">+</span> wins) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> zins;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x05;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> yins <span style="color:#f92672">+</span> wins;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x0A;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Closer between (1,0,0,1) and (0,1,1,0) will replace the further of a and b, if closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (xins <span style="color:#f92672">+</span> wins <span style="color:#f92672">&gt;</span> yins <span style="color:#f92672">+</span> zins) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> score <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> wins;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> score <span style="color:#f92672">&gt;</span> bScore) {
</span></span><span style="display:flex;"><span>          bScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          bPoint <span style="color:#f92672">=</span> 0x09;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> score <span style="color:#f92672">&gt;</span> aScore) {
</span></span><span style="display:flex;"><span>          aScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          aPoint <span style="color:#f92672">=</span> 0x09;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> score <span style="color:#f92672">=</span> yins <span style="color:#f92672">+</span> zins;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> score <span style="color:#f92672">&gt;</span> bScore) {
</span></span><span style="display:flex;"><span>          bScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          bPoint <span style="color:#f92672">=</span> 0x06;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> score <span style="color:#f92672">&gt;</span> aScore) {
</span></span><span style="display:flex;"><span>          aScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          aPoint <span style="color:#f92672">=</span> 0x06;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide if (1,0,0,0) is closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> inSum <span style="color:#f92672">+</span> xins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> p1 <span style="color:#f92672">&gt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> p1;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x01;
</span></span><span style="display:flex;"><span>        bIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> p1 <span style="color:#f92672">&gt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> p1;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x01;
</span></span><span style="display:flex;"><span>        aIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide if (0,1,0,0) is closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p2 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> inSum <span style="color:#f92672">+</span> yins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> p2 <span style="color:#f92672">&gt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> p2;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x02;
</span></span><span style="display:flex;"><span>        bIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> p2 <span style="color:#f92672">&gt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> p2;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x02;
</span></span><span style="display:flex;"><span>        aIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide if (0,0,1,0) is closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p3 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> inSum <span style="color:#f92672">+</span> zins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> p3 <span style="color:#f92672">&gt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> p3;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x04;
</span></span><span style="display:flex;"><span>        bIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> p3 <span style="color:#f92672">&gt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> p3;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x04;
</span></span><span style="display:flex;"><span>        aIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide if (0,0,0,1) is closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p4 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> inSum <span style="color:#f92672">+</span> wins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> p4 <span style="color:#f92672">&gt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> p4;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x08;
</span></span><span style="display:flex;"><span>        bIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> p4 <span style="color:#f92672">&gt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> p4;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x08;
</span></span><span style="display:flex;"><span>        aIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Where each of the two closest points are determines how the extra three vertices are calculated.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aIsBiggerSide <span style="color:#f92672">==</span> bIsBiggerSide) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aIsBiggerSide) { <span style="color:#75715e">//Both closest points on the bigger side</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">byte</span> c1 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">|</span> bPoint);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">byte</span> c2 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">&amp;</span> bPoint);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            xsv_ext0 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>            xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>            dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            zsv_ext0 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x08) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            wsv_ext0 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>            wsv_ext1 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>            dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//One combination is a permutation of (0,0,0,2) based on c2</span>
</span></span><span style="display:flex;"><span>          xsv_ext2 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          ysv_ext2 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          zsv_ext2 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          wsv_ext2 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>          dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            xsv_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>            dx_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>            dy_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            zsv_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>            dz_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            wsv_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>            dw_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//Both closest points on the smaller side</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//One of the two extra points is (0,0,0,0)</span>
</span></span><span style="display:flex;"><span>          xsv_ext2 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          ysv_ext2 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          zsv_ext2 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          wsv_ext2 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>          dx_ext2 <span style="color:#f92672">=</span> dx0;
</span></span><span style="display:flex;"><span>          dy_ext2 <span style="color:#f92672">=</span> dy0;
</span></span><span style="display:flex;"><span>          dz_ext2 <span style="color:#f92672">=</span> dz0;
</span></span><span style="display:flex;"><span>          dw_ext2 <span style="color:#f92672">=</span> dw0;
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//Other two points are based on the omitted axes.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">|</span> bPoint);
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>            xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>            dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dx_ext0 <span style="color:#f92672">=</span> dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0x01)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              ysv_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>              dy_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>              ysv_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>              dy_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>            dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x03) <span style="color:#f92672">==</span> 0x03)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              zsv_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>              dz_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>              zsv_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>              dz_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x08) <span style="color:#f92672">==</span> 0)
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            wsv_ext0 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>            wsv_ext1 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>            dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dw_ext0 <span style="color:#f92672">=</span> dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//One point on (0,0,0) side, one point on (1,1,1) side</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c1, c2;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aIsBiggerSide) {
</span></span><span style="display:flex;"><span>          c1 <span style="color:#f92672">=</span> aPoint;
</span></span><span style="display:flex;"><span>          c2 <span style="color:#f92672">=</span> bPoint;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          c1 <span style="color:#f92672">=</span> bPoint;
</span></span><span style="display:flex;"><span>          c2 <span style="color:#f92672">=</span> aPoint;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//Two contributions are the bigger-sided point with each 0 replaced with -1.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0x01) {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x03) <span style="color:#f92672">==</span> 0x03) {
</span></span><span style="display:flex;"><span>            zsv_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x08) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>          wsv_ext1 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">-</span> 1;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">+</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//One contribution is a permutation of (0,0,0,2) based on the smaller-sided point</span>
</span></span><span style="display:flex;"><span>        xsv_ext2 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>        ysv_ext2 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>        zsv_ext2 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>        wsv_ext2 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>        dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>          dx_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>          dy_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>          dz_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          wsv_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>          dw_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx1 <span style="color:#f92672">*</span> dx1 <span style="color:#f92672">-</span> dy1 <span style="color:#f92672">*</span> dy1 <span style="color:#f92672">-</span> dz1 <span style="color:#f92672">*</span> dz1 <span style="color:#f92672">-</span> dw1 <span style="color:#f92672">*</span> dw1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn1 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn1 <span style="color:#f92672">*=</span> attn1;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn1 <span style="color:#f92672">*</span> attn1 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 0, dx1, dy1, dz1, dw1);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz2 <span style="color:#f92672">=</span> dz1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw2 <span style="color:#f92672">=</span> dw1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn2 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx2 <span style="color:#f92672">*</span> dx2 <span style="color:#f92672">-</span> dy2 <span style="color:#f92672">*</span> dy2 <span style="color:#f92672">-</span> dz2 <span style="color:#f92672">*</span> dz2 <span style="color:#f92672">-</span> dw2 <span style="color:#f92672">*</span> dw2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn2 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn2 <span style="color:#f92672">*=</span> attn2;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn2 <span style="color:#f92672">*</span> attn2 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 0, dx2, dy2, dz2, dw2);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,0,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx3 <span style="color:#f92672">=</span> dx2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy3 <span style="color:#f92672">=</span> dy1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz3 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw3 <span style="color:#f92672">=</span> dw1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn3 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx3 <span style="color:#f92672">*</span> dx3 <span style="color:#f92672">-</span> dy3 <span style="color:#f92672">*</span> dy3 <span style="color:#f92672">-</span> dz3 <span style="color:#f92672">*</span> dz3 <span style="color:#f92672">-</span> dw3 <span style="color:#f92672">*</span> dw3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn3 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn3 <span style="color:#f92672">*=</span> attn3;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn3 <span style="color:#f92672">*</span> attn3 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 0, dx3, dy3, dz3, dw3);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,0,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx4 <span style="color:#f92672">=</span> dx2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy4 <span style="color:#f92672">=</span> dy1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz4 <span style="color:#f92672">=</span> dz1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw4 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn4 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx4 <span style="color:#f92672">*</span> dx4 <span style="color:#f92672">-</span> dy4 <span style="color:#f92672">*</span> dy4 <span style="color:#f92672">-</span> dz4 <span style="color:#f92672">*</span> dz4 <span style="color:#f92672">-</span> dw4 <span style="color:#f92672">*</span> dw4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn4 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn4 <span style="color:#f92672">*=</span> attn4;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn4 <span style="color:#f92672">*</span> attn4 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 1, dx4, dy4, dz4, dw4);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,1,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx5 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy5 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz5 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw5 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn5 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx5 <span style="color:#f92672">*</span> dx5 <span style="color:#f92672">-</span> dy5 <span style="color:#f92672">*</span> dy5 <span style="color:#f92672">-</span> dz5 <span style="color:#f92672">*</span> dz5 <span style="color:#f92672">-</span> dw5 <span style="color:#f92672">*</span> dw5;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn5 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn5 <span style="color:#f92672">*=</span> attn5;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn5 <span style="color:#f92672">*</span> attn5 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 0, dx5, dy5, dz5, dw5);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx6 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy6 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz6 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw6 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn6 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx6 <span style="color:#f92672">*</span> dx6 <span style="color:#f92672">-</span> dy6 <span style="color:#f92672">*</span> dy6 <span style="color:#f92672">-</span> dz6 <span style="color:#f92672">*</span> dz6 <span style="color:#f92672">-</span> dw6 <span style="color:#f92672">*</span> dw6;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn6 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn6 <span style="color:#f92672">*=</span> attn6;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn6 <span style="color:#f92672">*</span> attn6 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 0, dx6, dy6, dz6, dw6);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx7 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy7 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz7 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw7 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn7 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx7 <span style="color:#f92672">*</span> dx7 <span style="color:#f92672">-</span> dy7 <span style="color:#f92672">*</span> dy7 <span style="color:#f92672">-</span> dz7 <span style="color:#f92672">*</span> dz7 <span style="color:#f92672">-</span> dw7 <span style="color:#f92672">*</span> dw7;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn7 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn7 <span style="color:#f92672">*=</span> attn7;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn7 <span style="color:#f92672">*</span> attn7 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 1, dx7, dy7, dz7, dw7);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx8 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy8 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz8 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw8 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn8 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx8 <span style="color:#f92672">*</span> dx8 <span style="color:#f92672">-</span> dy8 <span style="color:#f92672">*</span> dy8 <span style="color:#f92672">-</span> dz8 <span style="color:#f92672">*</span> dz8 <span style="color:#f92672">-</span> dw8 <span style="color:#f92672">*</span> dw8;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn8 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn8 <span style="color:#f92672">*=</span> attn8;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn8 <span style="color:#f92672">*</span> attn8 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 0, dx8, dy8, dz8, dw8);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx9 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy9 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz9 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw9 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn9 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx9 <span style="color:#f92672">*</span> dx9 <span style="color:#f92672">-</span> dy9 <span style="color:#f92672">*</span> dy9 <span style="color:#f92672">-</span> dz9 <span style="color:#f92672">*</span> dz9 <span style="color:#f92672">-</span> dw9 <span style="color:#f92672">*</span> dw9;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn9 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn9 <span style="color:#f92672">*=</span> attn9;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn9 <span style="color:#f92672">*</span> attn9 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 1, dx9, dy9, dz9, dw9);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,0,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx10 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy10 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz10 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw10 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn10 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx10 <span style="color:#f92672">*</span> dx10 <span style="color:#f92672">-</span> dy10 <span style="color:#f92672">*</span> dy10 <span style="color:#f92672">-</span> dz10 <span style="color:#f92672">*</span> dz10 <span style="color:#f92672">-</span> dw10 <span style="color:#f92672">*</span> dw10;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn10 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn10 <span style="color:#f92672">*=</span> attn10;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn10 <span style="color:#f92672">*</span> attn10 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 1, dx10, dy10, dz10, dw10);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//We&#39;re inside the second dispentachoron (Rectified 4-Simplex)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> aScore;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> aPoint;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">boolean</span> aIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> bScore;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">byte</span> bPoint;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">boolean</span> bIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide between (0,0,1,1) and (1,1,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (xins <span style="color:#f92672">+</span> yins <span style="color:#f92672">&lt;</span> zins <span style="color:#f92672">+</span> wins) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> yins;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x0C;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> zins <span style="color:#f92672">+</span> wins;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x03;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide between (0,1,0,1) and (1,0,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (xins <span style="color:#f92672">+</span> zins <span style="color:#f92672">&lt;</span> yins <span style="color:#f92672">+</span> wins) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> zins;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x0A;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> yins <span style="color:#f92672">+</span> wins;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x05;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Closer between (0,1,1,0) and (1,0,0,1) will replace the further of a and b, if closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (xins <span style="color:#f92672">+</span> wins <span style="color:#f92672">&lt;</span> yins <span style="color:#f92672">+</span> zins) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> score <span style="color:#f92672">=</span> xins <span style="color:#f92672">+</span> wins;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> score <span style="color:#f92672">&lt;</span> bScore) {
</span></span><span style="display:flex;"><span>          bScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          bPoint <span style="color:#f92672">=</span> 0x06;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> score <span style="color:#f92672">&lt;</span> aScore) {
</span></span><span style="display:flex;"><span>          aScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          aPoint <span style="color:#f92672">=</span> 0x06;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> score <span style="color:#f92672">=</span> yins <span style="color:#f92672">+</span> zins;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> score <span style="color:#f92672">&lt;</span> bScore) {
</span></span><span style="display:flex;"><span>          bScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          bPoint <span style="color:#f92672">=</span> 0x09;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> score <span style="color:#f92672">&lt;</span> aScore) {
</span></span><span style="display:flex;"><span>          aScore <span style="color:#f92672">=</span> score;
</span></span><span style="display:flex;"><span>          aPoint <span style="color:#f92672">=</span> 0x09;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide if (0,1,1,1) is closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p1 <span style="color:#f92672">=</span> 3 <span style="color:#f92672">-</span> inSum <span style="color:#f92672">+</span> xins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> p1 <span style="color:#f92672">&lt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> p1;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x0E;
</span></span><span style="display:flex;"><span>        bIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> p1 <span style="color:#f92672">&lt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> p1;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x0E;
</span></span><span style="display:flex;"><span>        aIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide if (1,0,1,1) is closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p2 <span style="color:#f92672">=</span> 3 <span style="color:#f92672">-</span> inSum <span style="color:#f92672">+</span> yins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> p2 <span style="color:#f92672">&lt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> p2;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x0D;
</span></span><span style="display:flex;"><span>        bIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> p2 <span style="color:#f92672">&lt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> p2;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x0D;
</span></span><span style="display:flex;"><span>        aIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide if (1,1,0,1) is closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p3 <span style="color:#f92672">=</span> 3 <span style="color:#f92672">-</span> inSum <span style="color:#f92672">+</span> zins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> p3 <span style="color:#f92672">&lt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> p3;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x0B;
</span></span><span style="display:flex;"><span>        bIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> p3 <span style="color:#f92672">&lt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> p3;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x0B;
</span></span><span style="display:flex;"><span>        aIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Decide if (1,1,1,0) is closer.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> p4 <span style="color:#f92672">=</span> 3 <span style="color:#f92672">-</span> inSum <span style="color:#f92672">+</span> wins;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&lt;=</span> bScore <span style="color:#f92672">&amp;&amp;</span> p4 <span style="color:#f92672">&lt;</span> bScore) {
</span></span><span style="display:flex;"><span>        bScore <span style="color:#f92672">=</span> p4;
</span></span><span style="display:flex;"><span>        bPoint <span style="color:#f92672">=</span> 0x07;
</span></span><span style="display:flex;"><span>        bIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (aScore <span style="color:#f92672">&gt;</span> bScore <span style="color:#f92672">&amp;&amp;</span> p4 <span style="color:#f92672">&lt;</span> aScore) {
</span></span><span style="display:flex;"><span>        aScore <span style="color:#f92672">=</span> p4;
</span></span><span style="display:flex;"><span>        aPoint <span style="color:#f92672">=</span> 0x07;
</span></span><span style="display:flex;"><span>        aIsBiggerSide <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Where each of the two closest points are determines how the extra three vertices are calculated.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (aIsBiggerSide <span style="color:#f92672">==</span> bIsBiggerSide) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aIsBiggerSide) { <span style="color:#75715e">//Both closest points on the bigger side</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">byte</span> c1 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">&amp;</span> bPoint);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">byte</span> c2 <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">|</span> bPoint);
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//Two contributions are permutations of (0,0,0,1) and (0,0,0,2) based on c1</span>
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            xsv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dx_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            xsv_ext1 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            zsv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            wsv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dw_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            wsv_ext1 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>            dw_ext1 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//One contribution is a permutation of (1,1,1,-1) based on c2</span>
</span></span><span style="display:flex;"><span>          xsv_ext2 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          ysv_ext2 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          zsv_ext2 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          wsv_ext2 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            xsv_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>            dx_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>            dy_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            zsv_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>            dz_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            wsv_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>            dw_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//Both closest points on the smaller side</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//One of the two extra points is (1,1,1,1)</span>
</span></span><span style="display:flex;"><span>          xsv_ext2 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          ysv_ext2 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          zsv_ext2 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          wsv_ext2 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 4 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">//Other two points are based on the shared axes.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">byte</span> c <span style="color:#f92672">=</span> (<span style="color:#66d9ef">byte</span>)(aPoint <span style="color:#f92672">&amp;</span> bPoint);
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>            xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>            dx_ext0 <span style="color:#f92672">=</span> dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              ysv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>              dy_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>              ysv_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>              dy_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>            zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x03) <span style="color:#f92672">==</span> 0)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>              zsv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>              dz_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>              zsv_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>              dz_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>            dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c <span style="color:#f92672">&amp;</span> 0x08) <span style="color:#f92672">!=</span> 0)
</span></span><span style="display:flex;"><span>          {
</span></span><span style="display:flex;"><span>            wsv_ext0 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>            wsv_ext1 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>            dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>            dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>            dw_ext0 <span style="color:#f92672">=</span> dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">else</span> { <span style="color:#75715e">//One point on each &#34;side&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">byte</span> c1, c2;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (aIsBiggerSide) {
</span></span><span style="display:flex;"><span>          c1 <span style="color:#f92672">=</span> aPoint;
</span></span><span style="display:flex;"><span>          c2 <span style="color:#f92672">=</span> bPoint;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          c1 <span style="color:#f92672">=</span> bPoint;
</span></span><span style="display:flex;"><span>          c2 <span style="color:#f92672">=</span> aPoint;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//Two contributions are the bigger-sided point with each 1 replaced with 2.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          xsv_ext1 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          xsv_ext0 <span style="color:#f92672">=</span> xsv_ext1 <span style="color:#f92672">=</span> xsb;
</span></span><span style="display:flex;"><span>          dx_ext0 <span style="color:#f92672">=</span> dx_ext1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            ysv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            ysv_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dy_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          ysv_ext0 <span style="color:#f92672">=</span> ysv_ext1 <span style="color:#f92672">=</span> ysb;
</span></span><span style="display:flex;"><span>          dy_ext0 <span style="color:#f92672">=</span> dy_ext1 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x03) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>            zsv_ext0 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext0 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            zsv_ext1 <span style="color:#f92672">+=</span> 1;
</span></span><span style="display:flex;"><span>            dz_ext1 <span style="color:#f92672">-=</span> 1;
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          zsv_ext0 <span style="color:#f92672">=</span> zsv_ext1 <span style="color:#f92672">=</span> zsb;
</span></span><span style="display:flex;"><span>          dz_ext0 <span style="color:#f92672">=</span> dz_ext1 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c1 <span style="color:#f92672">&amp;</span> 0x08) <span style="color:#f92672">!=</span> 0) {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>          wsv_ext1 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 2;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>          dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          wsv_ext0 <span style="color:#f92672">=</span> wsv_ext1 <span style="color:#f92672">=</span> wsb;
</span></span><span style="display:flex;"><span>          dw_ext0 <span style="color:#f92672">=</span> dw_ext1 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">//One contribution is a permutation of (1,1,1,-1) based on the smaller-sided point</span>
</span></span><span style="display:flex;"><span>        xsv_ext2 <span style="color:#f92672">=</span> xsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        ysv_ext2 <span style="color:#f92672">=</span> ysb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        zsv_ext2 <span style="color:#f92672">=</span> zsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        wsv_ext2 <span style="color:#f92672">=</span> wsb <span style="color:#f92672">+</span> 1;
</span></span><span style="display:flex;"><span>        dx_ext2 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        dy_ext2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        dz_ext2 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        dw_ext2 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x01) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          xsv_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          dx_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x02) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          ysv_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          dy_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ((c2 <span style="color:#f92672">&amp;</span> 0x04) <span style="color:#f92672">==</span> 0) {
</span></span><span style="display:flex;"><span>          zsv_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          dz_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          wsv_ext2 <span style="color:#f92672">-=</span> 2;
</span></span><span style="display:flex;"><span>          dw_ext2 <span style="color:#f92672">+=</span> 2;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,1,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx4 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy4 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz4 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw4 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn4 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx4 <span style="color:#f92672">*</span> dx4 <span style="color:#f92672">-</span> dy4 <span style="color:#f92672">*</span> dy4 <span style="color:#f92672">-</span> dz4 <span style="color:#f92672">*</span> dz4 <span style="color:#f92672">-</span> dw4 <span style="color:#f92672">*</span> dw4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn4 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn4 <span style="color:#f92672">*=</span> attn4;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn4 <span style="color:#f92672">*</span> attn4 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 0, dx4, dy4, dz4, dw4);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,1,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx3 <span style="color:#f92672">=</span> dx4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy3 <span style="color:#f92672">=</span> dy4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz3 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw3 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn3 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx3 <span style="color:#f92672">*</span> dx3 <span style="color:#f92672">-</span> dy3 <span style="color:#f92672">*</span> dy3 <span style="color:#f92672">-</span> dz3 <span style="color:#f92672">*</span> dz3 <span style="color:#f92672">-</span> dw3 <span style="color:#f92672">*</span> dw3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn3 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn3 <span style="color:#f92672">*=</span> attn3;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn3 <span style="color:#f92672">*</span> attn3 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 1, dx3, dy3, dz3, dw3);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx2 <span style="color:#f92672">=</span> dx4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy2 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz2 <span style="color:#f92672">=</span> dz4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw2 <span style="color:#f92672">=</span> dw3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn2 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx2 <span style="color:#f92672">*</span> dx2 <span style="color:#f92672">-</span> dy2 <span style="color:#f92672">*</span> dy2 <span style="color:#f92672">-</span> dz2 <span style="color:#f92672">*</span> dz2 <span style="color:#f92672">-</span> dw2 <span style="color:#f92672">*</span> dw2;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn2 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn2 <span style="color:#f92672">*=</span> attn2;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn2 <span style="color:#f92672">*</span> attn2 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 1, dx2, dy2, dz2, dw2);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx1 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 3 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz1 <span style="color:#f92672">=</span> dz4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy1 <span style="color:#f92672">=</span> dy4;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw1 <span style="color:#f92672">=</span> dw3;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx1 <span style="color:#f92672">*</span> dx1 <span style="color:#f92672">-</span> dy1 <span style="color:#f92672">*</span> dy1 <span style="color:#f92672">-</span> dz1 <span style="color:#f92672">*</span> dz1 <span style="color:#f92672">-</span> dw1 <span style="color:#f92672">*</span> dw1;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn1 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn1 <span style="color:#f92672">*=</span> attn1;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn1 <span style="color:#f92672">*</span> attn1 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 1, dx1, dy1, dz1, dw1);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,1,0,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx5 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy5 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz5 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw5 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn5 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx5 <span style="color:#f92672">*</span> dx5 <span style="color:#f92672">-</span> dy5 <span style="color:#f92672">*</span> dy5 <span style="color:#f92672">-</span> dz5 <span style="color:#f92672">*</span> dz5 <span style="color:#f92672">-</span> dw5 <span style="color:#f92672">*</span> dw5;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn5 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn5 <span style="color:#f92672">*=</span> attn5;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn5 <span style="color:#f92672">*</span> attn5 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 0, dx5, dy5, dz5, dw5);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx6 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy6 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz6 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw6 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn6 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx6 <span style="color:#f92672">*</span> dx6 <span style="color:#f92672">-</span> dy6 <span style="color:#f92672">*</span> dy6 <span style="color:#f92672">-</span> dz6 <span style="color:#f92672">*</span> dz6 <span style="color:#f92672">-</span> dw6 <span style="color:#f92672">*</span> dw6;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn6 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn6 <span style="color:#f92672">*=</span> attn6;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn6 <span style="color:#f92672">*</span> attn6 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 0, dx6, dy6, dz6, dw6);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (1,0,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx7 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy7 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz7 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw7 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn7 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx7 <span style="color:#f92672">*</span> dx7 <span style="color:#f92672">-</span> dy7 <span style="color:#f92672">*</span> dy7 <span style="color:#f92672">-</span> dz7 <span style="color:#f92672">*</span> dz7 <span style="color:#f92672">-</span> dw7 <span style="color:#f92672">*</span> dw7;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn7 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn7 <span style="color:#f92672">*=</span> attn7;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn7 <span style="color:#f92672">*</span> attn7 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 1, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 1, dx7, dy7, dz7, dw7);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,1,0)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx8 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy8 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz8 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw8 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn8 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx8 <span style="color:#f92672">*</span> dx8 <span style="color:#f92672">-</span> dy8 <span style="color:#f92672">*</span> dy8 <span style="color:#f92672">-</span> dz8 <span style="color:#f92672">*</span> dz8 <span style="color:#f92672">-</span> dw8 <span style="color:#f92672">*</span> dw8;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn8 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn8 <span style="color:#f92672">*=</span> attn8;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn8 <span style="color:#f92672">*</span> attn8 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 0, dx8, dy8, dz8, dw8);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,1,0,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx9 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy9 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz9 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw9 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn9 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx9 <span style="color:#f92672">*</span> dx9 <span style="color:#f92672">-</span> dy9 <span style="color:#f92672">*</span> dy9 <span style="color:#f92672">-</span> dz9 <span style="color:#f92672">*</span> dz9 <span style="color:#f92672">-</span> dw9 <span style="color:#f92672">*</span> dw9;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn9 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn9 <span style="color:#f92672">*=</span> attn9;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn9 <span style="color:#f92672">*</span> attn9 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 1, zsb <span style="color:#f92672">+</span> 0, wsb <span style="color:#f92672">+</span> 1, dx9, dy9, dz9, dw9);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">//Contribution (0,0,1,1)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dx10 <span style="color:#f92672">=</span> dx0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dy10 <span style="color:#f92672">=</span> dy0 <span style="color:#f92672">-</span> 0 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dz10 <span style="color:#f92672">=</span> dz0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> dw10 <span style="color:#f92672">=</span> dw0 <span style="color:#f92672">-</span> 1 <span style="color:#f92672">-</span> 2 <span style="color:#f92672">*</span> SQUISH_CONSTANT_4D;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> attn10 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx10 <span style="color:#f92672">*</span> dx10 <span style="color:#f92672">-</span> dy10 <span style="color:#f92672">*</span> dy10 <span style="color:#f92672">-</span> dz10 <span style="color:#f92672">*</span> dz10 <span style="color:#f92672">-</span> dw10 <span style="color:#f92672">*</span> dw10;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (attn10 <span style="color:#f92672">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>        attn10 <span style="color:#f92672">*=</span> attn10;
</span></span><span style="display:flex;"><span>        value <span style="color:#f92672">+=</span> attn10 <span style="color:#f92672">*</span> attn10 <span style="color:#f92672">*</span> extrapolate(xsb <span style="color:#f92672">+</span> 0, ysb <span style="color:#f92672">+</span> 0, zsb <span style="color:#f92672">+</span> 1, wsb <span style="color:#f92672">+</span> 1, dx10, dy10, dz10, dw10);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//First extra vertex</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> attn_ext0 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx_ext0 <span style="color:#f92672">*</span> dx_ext0 <span style="color:#f92672">-</span> dy_ext0 <span style="color:#f92672">*</span> dy_ext0 <span style="color:#f92672">-</span> dz_ext0 <span style="color:#f92672">*</span> dz_ext0 <span style="color:#f92672">-</span> dw_ext0 <span style="color:#f92672">*</span> dw_ext0;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (attn_ext0 <span style="color:#f92672">&gt;</span> 0)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      attn_ext0 <span style="color:#f92672">*=</span> attn_ext0;
</span></span><span style="display:flex;"><span>      value <span style="color:#f92672">+=</span> attn_ext0 <span style="color:#f92672">*</span> attn_ext0 <span style="color:#f92672">*</span> extrapolate(xsv_ext0, ysv_ext0, zsv_ext0, wsv_ext0, dx_ext0, dy_ext0, dz_ext0, dw_ext0);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Second extra vertex</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> attn_ext1 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx_ext1 <span style="color:#f92672">*</span> dx_ext1 <span style="color:#f92672">-</span> dy_ext1 <span style="color:#f92672">*</span> dy_ext1 <span style="color:#f92672">-</span> dz_ext1 <span style="color:#f92672">*</span> dz_ext1 <span style="color:#f92672">-</span> dw_ext1 <span style="color:#f92672">*</span> dw_ext1;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (attn_ext1 <span style="color:#f92672">&gt;</span> 0)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      attn_ext1 <span style="color:#f92672">*=</span> attn_ext1;
</span></span><span style="display:flex;"><span>      value <span style="color:#f92672">+=</span> attn_ext1 <span style="color:#f92672">*</span> attn_ext1 <span style="color:#f92672">*</span> extrapolate(xsv_ext1, ysv_ext1, zsv_ext1, wsv_ext1, dx_ext1, dy_ext1, dz_ext1, dw_ext1);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Third extra vertex</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> attn_ext2 <span style="color:#f92672">=</span> 2 <span style="color:#f92672">-</span> dx_ext2 <span style="color:#f92672">*</span> dx_ext2 <span style="color:#f92672">-</span> dy_ext2 <span style="color:#f92672">*</span> dy_ext2 <span style="color:#f92672">-</span> dz_ext2 <span style="color:#f92672">*</span> dz_ext2 <span style="color:#f92672">-</span> dw_ext2 <span style="color:#f92672">*</span> dw_ext2;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (attn_ext2 <span style="color:#f92672">&gt;</span> 0)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      attn_ext2 <span style="color:#f92672">*=</span> attn_ext2;
</span></span><span style="display:flex;"><span>      value <span style="color:#f92672">+=</span> attn_ext2 <span style="color:#f92672">*</span> attn_ext2 <span style="color:#f92672">*</span> extrapolate(xsv_ext2, ysv_ext2, zsv_ext2, wsv_ext2, dx_ext2, dy_ext2, dz_ext2, dw_ext2);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> value <span style="color:#f92672">/</span> NORM_CONSTANT_4D;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">extrapolate</span>(<span style="color:#66d9ef">int</span> xsb, <span style="color:#66d9ef">int</span> ysb, <span style="color:#66d9ef">double</span> dx, <span style="color:#66d9ef">double</span> dy)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> perm<span style="color:#f92672">[</span>(perm<span style="color:#f92672">[</span>xsb <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> ysb) <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;</span> 0x0E;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> gradients2D<span style="color:#f92672">[</span>index<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> dx
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">+</span> gradients2D<span style="color:#f92672">[</span>index <span style="color:#f92672">+</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> dy;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">extrapolate</span>(<span style="color:#66d9ef">int</span> xsb, <span style="color:#66d9ef">int</span> ysb, <span style="color:#66d9ef">int</span> zsb, <span style="color:#66d9ef">double</span> dx, <span style="color:#66d9ef">double</span> dy, <span style="color:#66d9ef">double</span> dz)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> permGradIndex3D<span style="color:#f92672">[</span>(perm<span style="color:#f92672">[</span>(perm<span style="color:#f92672">[</span>xsb <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> ysb) <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> zsb) <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> gradients3D<span style="color:#f92672">[</span>index<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> dx
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">+</span> gradients3D<span style="color:#f92672">[</span>index <span style="color:#f92672">+</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> dy
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">+</span> gradients3D<span style="color:#f92672">[</span>index <span style="color:#f92672">+</span> 2<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> dz;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">extrapolate</span>(<span style="color:#66d9ef">int</span> xsb, <span style="color:#66d9ef">int</span> ysb, <span style="color:#66d9ef">int</span> zsb, <span style="color:#66d9ef">int</span> wsb, <span style="color:#66d9ef">double</span> dx, <span style="color:#66d9ef">double</span> dy, <span style="color:#66d9ef">double</span> dz, <span style="color:#66d9ef">double</span> dw)
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> perm<span style="color:#f92672">[</span>(perm<span style="color:#f92672">[</span>(perm<span style="color:#f92672">[</span>(perm<span style="color:#f92672">[</span>xsb <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> ysb) <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> zsb) <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> wsb) <span style="color:#f92672">&amp;</span> 0xFF<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;</span> 0xFC;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> gradients4D<span style="color:#f92672">[</span>index<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> dx
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">+</span> gradients4D<span style="color:#f92672">[</span>index <span style="color:#f92672">+</span> 1<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> dy
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">+</span> gradients4D<span style="color:#f92672">[</span>index <span style="color:#f92672">+</span> 2<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> dz
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">+</span> gradients4D<span style="color:#f92672">[</span>index <span style="color:#f92672">+</span> 3<span style="color:#f92672">]</span> <span style="color:#f92672">*</span> dw;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">fastFloor</span>(<span style="color:#66d9ef">double</span> x) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> xi <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span>)x;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x <span style="color:#f92672">&lt;</span> xi <span style="color:#f92672">?</span> xi <span style="color:#f92672">-</span> 1 : xi;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//Gradients for 2D. They approximate the directions to the</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//vertices of an octagon from the center.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> gradients2D <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> {
</span></span><span style="display:flex;"><span>     5,  2,    2,  5,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span>5,  2,   <span style="color:#f92672">-</span>2,  5,
</span></span><span style="display:flex;"><span>     5, <span style="color:#f92672">-</span>2,    2, <span style="color:#f92672">-</span>5,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span>5, <span style="color:#f92672">-</span>2,   <span style="color:#f92672">-</span>2, <span style="color:#f92672">-</span>5,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//Gradients for 3D. They approximate the directions to the</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//vertices of a rhombicuboctahedron from the center, skewed so</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//that the triangular and square facets can be inscribed inside</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//circles of the same radius.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> gradients3D <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span>11,  4,  4,     <span style="color:#f92672">-</span>4,  11,  4,    <span style="color:#f92672">-</span>4,  4,  11,
</span></span><span style="display:flex;"><span>     11,  4,  4,      4,  11,  4,     4,  4,  11,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span>11, <span style="color:#f92672">-</span>4,  4,     <span style="color:#f92672">-</span>4, <span style="color:#f92672">-</span>11,  4,    <span style="color:#f92672">-</span>4, <span style="color:#f92672">-</span>4,  11,
</span></span><span style="display:flex;"><span>     11, <span style="color:#f92672">-</span>4,  4,      4, <span style="color:#f92672">-</span>11,  4,     4, <span style="color:#f92672">-</span>4,  11,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span>11,  4, <span style="color:#f92672">-</span>4,     <span style="color:#f92672">-</span>4,  11, <span style="color:#f92672">-</span>4,    <span style="color:#f92672">-</span>4,  4, <span style="color:#f92672">-</span>11,
</span></span><span style="display:flex;"><span>     11,  4, <span style="color:#f92672">-</span>4,      4,  11, <span style="color:#f92672">-</span>4,     4,  4, <span style="color:#f92672">-</span>11,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">-</span>11, <span style="color:#f92672">-</span>4, <span style="color:#f92672">-</span>4,     <span style="color:#f92672">-</span>4, <span style="color:#f92672">-</span>11, <span style="color:#f92672">-</span>4,    <span style="color:#f92672">-</span>4, <span style="color:#f92672">-</span>4, <span style="color:#f92672">-</span>11,
</span></span><span style="display:flex;"><span>     11, <span style="color:#f92672">-</span>4, <span style="color:#f92672">-</span>4,      4, <span style="color:#f92672">-</span>11, <span style="color:#f92672">-</span>4,     4, <span style="color:#f92672">-</span>4, <span style="color:#f92672">-</span>11,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//Gradients for 4D. They approximate the directions to the</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//vertices of a disprismatotesseractihexadecachoron from the center,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//skewed so that the tetrahedral and cubic facets can be inscribed inside</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//spheres of the same radius.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> gradients4D <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> {
</span></span><span style="display:flex;"><span>       3,  1,  1,  1,      1,  3,  1,  1,      1,  1,  3,  1,      1,  1,  1,  3,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span>3,  1,  1,  1,     <span style="color:#f92672">-</span>1,  3,  1,  1,     <span style="color:#f92672">-</span>1,  1,  3,  1,     <span style="color:#f92672">-</span>1,  1,  1,  3,
</span></span><span style="display:flex;"><span>       3, <span style="color:#f92672">-</span>1,  1,  1,      1, <span style="color:#f92672">-</span>3,  1,  1,      1, <span style="color:#f92672">-</span>1,  3,  1,      1, <span style="color:#f92672">-</span>1,  1,  3,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1,  1,  1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3,  1,  1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,  3,  1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,  1,  3,
</span></span><span style="display:flex;"><span>       3,  1, <span style="color:#f92672">-</span>1,  1,      1,  3, <span style="color:#f92672">-</span>1,  1,      1,  1, <span style="color:#f92672">-</span>3,  1,      1,  1, <span style="color:#f92672">-</span>1,  3,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span>3,  1, <span style="color:#f92672">-</span>1,  1,     <span style="color:#f92672">-</span>1,  3, <span style="color:#f92672">-</span>1,  1,     <span style="color:#f92672">-</span>1,  1, <span style="color:#f92672">-</span>3,  1,     <span style="color:#f92672">-</span>1,  1, <span style="color:#f92672">-</span>1,  3,
</span></span><span style="display:flex;"><span>       3, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,  1,      1, <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1,  1,      1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3,  1,      1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,  3,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,  1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1,  1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3,  1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,  3,
</span></span><span style="display:flex;"><span>       3,  1,  1, <span style="color:#f92672">-</span>1,      1,  3,  1, <span style="color:#f92672">-</span>1,      1,  1,  3, <span style="color:#f92672">-</span>1,      1,  1,  1, <span style="color:#f92672">-</span>3,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span>3,  1,  1, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1,  3,  1, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1,  1,  3, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1,  1,  1, <span style="color:#f92672">-</span>3,
</span></span><span style="display:flex;"><span>       3, <span style="color:#f92672">-</span>1,  1, <span style="color:#f92672">-</span>1,      1, <span style="color:#f92672">-</span>3,  1, <span style="color:#f92672">-</span>1,      1, <span style="color:#f92672">-</span>1,  3, <span style="color:#f92672">-</span>1,      1, <span style="color:#f92672">-</span>1,  1, <span style="color:#f92672">-</span>3,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1,  1, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3,  1, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,  3, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,  1, <span style="color:#f92672">-</span>3,
</span></span><span style="display:flex;"><span>       3,  1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,      1,  3, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,      1,  1, <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1,      1,  1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span>3,  1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1,  3, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1,  1, <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1,  1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3,
</span></span><span style="display:flex;"><span>       3, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,      1, <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,      1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1,      1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3, <span style="color:#f92672">-</span>1,     <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>1, <span style="color:#f92672">-</span>3,
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    </section>
</article>

<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    document.querySelectorAll('pre code').forEach((block) => {
      const button = document.createElement('button');
      button.className = 'copy-button';
      button.textContent = 'Copy';
      button.addEventListener('click', () => {
        navigator.clipboard.writeText(block.textContent)
          .then(() => {
            button.textContent = 'Copied!';
            setTimeout(() => { button.textContent = 'Copy'; }, 2000);
          })
          .catch(err => {
            console.error('Copy failed', err);
            button.textContent = 'Error';
            setTimeout(() => { button.textContent = 'Copy'; }, 2000);
          });
      });
      block.parentNode.insertBefore(button, block);
    });
  });
</script>

        </main>

        
        <div class="nav-right">
            
                
<section>
    <h2>Categories</h2>
    <ul>
        
        <li><a href="https://trimad.github.io/categories/active-directory/">Active Directory (4)</a></li>
        
        <li><a href="https://trimad.github.io/categories/ai/">AI (3)</a></li>
        
        <li><a href="https://trimad.github.io/categories/azure-ad/">Azure AD (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/c%23/">C# (2)</a></li>
        
        <li><a href="https://trimad.github.io/categories/c&#43;&#43;/">C&#43;&#43; (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/computer-vision/">Computer Vision (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/dns/">DNS (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/exchange/">Exchange (2)</a></li>
        
        <li><a href="https://trimad.github.io/categories/google/">Google (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/image-processing/">Image Processing (2)</a></li>
        
        <li><a href="https://trimad.github.io/categories/java/">Java (32)</a></li>
        
        <li><a href="https://trimad.github.io/categories/javascript/">JavaScript (17)</a></li>
        
        <li><a href="https://trimad.github.io/categories/machine-learning/">Machine Learning (3)</a></li>
        
        <li><a href="https://trimad.github.io/categories/masm/">MASM (3)</a></li>
        
        <li><a href="https://trimad.github.io/categories/media-processing/">Media Processing (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/microsoft-365/">Microsoft 365 (2)</a></li>
        
        <li><a href="https://trimad.github.io/categories/microsoft-office/">Microsoft Office (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/microsoft-teams/">Microsoft Teams (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/networking/">Networking (4)</a></li>
        
        <li><a href="https://trimad.github.io/categories/nodejs/">Nodejs (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/office-365/">Office 365 (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/p5.js/">P5.js (9)</a></li>
        
        <li><a href="https://trimad.github.io/categories/powershell/">PowerShell (24)</a></li>
        
        <li><a href="https://trimad.github.io/categories/processing/">Processing (14)</a></li>
        
        <li><a href="https://trimad.github.io/categories/programming/">Programming (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/python/">Python (19)</a></li>
        
        <li><a href="https://trimad.github.io/categories/reference/">Reference (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/security/">Security (8)</a></li>
        
        <li><a href="https://trimad.github.io/categories/shell/">Shell (16)</a></li>
        
        <li><a href="https://trimad.github.io/categories/system-administration/">System Administration (4)</a></li>
        
        <li><a href="https://trimad.github.io/categories/teams/">Teams (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/visualization/">Visualization (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/web-administration/">Web Administration (1)</a></li>
        
        <li><a href="https://trimad.github.io/categories/web-development/">Web Development (2)</a></li>
        
        <li><a href="https://trimad.github.io/categories/windows/">Windows (9)</a></li>
        
    </ul>
</section>


<section>
    <h2>Tags</h2>
    <ul>
        
        <li><a href="https://trimad.github.io/tags/10print/">10PRINT (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/3d-modeling/">3d-Modeling (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/3n&#43;1/">3n&#43;1 (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/account-management/">Account Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/acl/">Acl (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/active-directory/">Active-Directory (10)</a></li>
        
        <li><a href="https://trimad.github.io/tags/ad-sync/">Ad Sync (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/ai/">Ai (9)</a></li>
        
        <li><a href="https://trimad.github.io/tags/android/">Android (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/animation/">Animation (10)</a></li>
        
        <li><a href="https://trimad.github.io/tags/api/">Api (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/arrays/">Arrays (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/assembly/">Assembly (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/audio/">Audio (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/audio-conversion/">Audio Conversion (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/automation/">Automation (13)</a></li>
        
        <li><a href="https://trimad.github.io/tags/azure/">Azure (4)</a></li>
        
        <li><a href="https://trimad.github.io/tags/azure-ad-connect/">Azure Ad Connect (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/base64/">Base64 (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/bat/">Bat (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/batch-processing/">Batch-Processing (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/bipartite-graph/">Bipartite Graph (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/bitset/">Bitset (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/buddhabrot/">Buddhabrot (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/calendars/">Calendars (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/channel-management/">Channel Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/client-side/">Client-Side (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/cmd/">Cmd (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/coding-challenge/">Coding Challenge (15)</a></li>
        
        <li><a href="https://trimad.github.io/tags/collaboration/">Collaboration (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/collatz-conjecture/">Collatz Conjecture (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/command-line/">Command-Line (6)</a></li>
        
        <li><a href="https://trimad.github.io/tags/compliance/">Compliance (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/computer-vision/">Computer-Vision (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/coqui-tts/">Coqui-Tts (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/counting-sort/">Counting Sort (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/creative-coding/">Creative-Coding (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/cuda/">Cuda (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/curl/">Curl (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/cybersecurity/">Cybersecurity (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/dag/">Dag (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/data-visualization/">Data-Visualization (5)</a></li>
        
        <li><a href="https://trimad.github.io/tags/debugging/">Debugging (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/decoding/">Decoding (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/depth-estimation/">Depth Estimation (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/device-management/">Device Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/directed-acyclic-graph/">Directed Acyclic Graph (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/directory-services/">Directory-Services (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/disjoint-set/">Disjoint Set (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/distance/">Distance (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/dkim/">Dkim (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/dmarc/">Dmarc (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/dns/">Dns (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/domain/">Domain (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/domain-controller/">Domain Controller (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/domain-security/">Domain Security (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/domain-management/">Domain-Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/download/">Download (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/drivers/">Drivers (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/drives/">Drives (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/education/">Education (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/email/">Email (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/email-management/">Email Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/email-security/">Email Security (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/email-archiving/">Email-Archiving (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/events/">Events (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/exchange/">Exchange (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/exchange-management/">Exchange-Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/exchange-online/">Exchange-Online (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/exchangeonlinemanagement/">ExchangeOnlineManagement (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/ffmpeg/">Ffmpeg (4)</a></li>
        
        <li><a href="https://trimad.github.io/tags/fibonacci/">Fibonacci (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/file-permissions/">File-Permissions (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/file-system/">File-System (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/film/">Film (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/filtering/">Filtering (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/finance/">Finance (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/firewall/">Firewall (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/flask/">Flask (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/fractal/">Fractal (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/frame-interpolation/">Frame Interpolation (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/gal/">Gal (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/gmail/">Gmail (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/google-forms/">Google Forms (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/google-apps-script/">Google-Apps-Script (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/google-drive/">Google-Drive (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/gpu/">Gpu (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/graphs/">Graphs (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/group/">Group (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/group-management/">Group Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/group-policy/">Group-Policy (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/gsuite/">Gsuite (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/hacked-accounts/">Hacked Accounts (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/hardware/">Hardware (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/hex-encoding/">Hex Encoding (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/iis/">Iis (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/image-processing/">Image-Processing (4)</a></li>
        
        <li><a href="https://trimad.github.io/tags/images/">Images (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/incident-response/">Incident Response (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/insertion-sort/">Insertion Sort (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/installation/">Installation (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/interactive/">Interactive (9)</a></li>
        
        <li><a href="https://trimad.github.io/tags/ip-address/">Ip-Address (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/ip-addressing/">Ip-Addressing (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/java/">Java (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/javascript/">Javascript (5)</a></li>
        
        <li><a href="https://trimad.github.io/tags/juno/">Juno (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/jupiter/">Jupiter (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/k-means/">K-Means (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/kattis/">Kattis (6)</a></li>
        
        <li><a href="https://trimad.github.io/tags/keyboard/">Keyboard (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/knowledge-graphs/">Knowledge-Graphs (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/kruskals-algorithm/">Kruskal&#39;s Algorithm (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/lan/">Lan (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/llm/">Llm (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/local-administrator/">Local Administrator (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/local-ai/">Local-Ai (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/logging/">Logging (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/lorenz-system/">Lorenz System (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/m365/">M365 (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/machine-learning/">Machine-Learning (6)</a></li>
        
        <li><a href="https://trimad.github.io/tags/maximum-flow/">Maximum Flow (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/media-processing/">Media Processing (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/merge-sort/">Merge Sort (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/microsoft-teams/">Microsoft Teams (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/microsoft-office/">Microsoft-Office (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/midas/">Midas (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/minimum-spanning-tree/">Minimum Spanning Tree (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/mistral-7b/">Mistral-7b (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/monitoring/">Monitoring (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/moondream/">Moondream (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/multilingual/">Multilingual (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/mx/">Mx (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/n-central/">N-Central (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/natural-language-processing/">Natural Language Processing (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/net/">Net (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/netsh/">Netsh (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/network/">Network (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/network-drives/">Network Drives (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/network-analysis/">Network-Analysis (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/network-security/">Network-Security (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/networking/">Networking (5)</a></li>
        
        <li><a href="https://trimad.github.io/tags/networkx/">Networkx (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/nlp/">Nlp (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/nslookup/">Nslookup (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/obfuscation/">Obfuscation (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/office-365/">Office-365 (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/office365/">Office365 (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/officec2rclient/">Officec2rclient (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/open-simplex-noise/">Open Simplex Noise (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/openai/">Openai (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/optimization/">Optimization (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/p5.js/">P5.js (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/p5js/">P5js (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/password-management/">Password Management (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/password-generator/">Password-Generator (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/passwords/">Passwords (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/perlin-noise/">Perlin Noise (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/permissions/">Permissions (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/phishing/">Phishing (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/photo-editing/">Photo-Editing (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/pil/">Pil (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/pillow/">Pillow (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/port-management/">Port-Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/powershell/">Powershell (22)</a></li>
        
        <li><a href="https://trimad.github.io/tags/prims-algorithm/">Prim&#39;s Algorithm (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/prime-numbers/">Prime Numbers (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/printers/">Printers (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/procdump/">Procdump (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/processing/">Processing (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/programming/">Programming (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/python/">Python (15)</a></li>
        
        <li><a href="https://trimad.github.io/tags/python-script/">Python-Script (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/pyvis/">Pyvis (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/qr-code/">Qr-Code (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/rdp/">Rdp (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/reference/">Reference (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/registry-modification/">Registry Modification (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/remote-access/">Remote-Access (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/reporting/">Reporting (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/reports/">Reports (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/robocopy/">Robocopy (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/screen-recording/">Screen Recording (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/scripting/">Scripting (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/sdk/">SDK (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/security/">Security (9)</a></li>
        
        <li><a href="https://trimad.github.io/tags/security-analysis/">Security Analysis (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/security-management/">Security Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/settings/">Settings (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/shell/">Shell (4)</a></li>
        
        <li><a href="https://trimad.github.io/tags/sid/">SID (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/smtp/">Smtp (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/sorting/">Sorting (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/sound/">Sound (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/space/">Space (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/speech-recognition/">Speech Recognition (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/spf/">Spf (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/spiral/">Spiral (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/stable-diffusion/">Stable-Diffusion (2)</a></li>
        
        <li><a href="https://trimad.github.io/tags/stocks/">Stocks (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/string/">String (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/subnets/">Subnets (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/synchronization/">Synchronization (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/sysinternals/">Sysinternals (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/system-administration/">System-Administration (13)</a></li>
        
        <li><a href="https://trimad.github.io/tags/systeminfo/">Systeminfo (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/team-management/">Team Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/team-ownership/">Team Ownership (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/tensorflow/">Tensorflow (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/therafit/">Therafit (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/time/">Time (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/topological-sort/">Topological Sort (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/troubleshooting/">Troubleshooting (4)</a></li>
        
        <li><a href="https://trimad.github.io/tags/tzutil/">Tzutil (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/udm/">UDM (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/uri/">Uri (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/uri-encoding/">Uri Encoding (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/user-management/">User-Management (4)</a></li>
        
        <li><a href="https://trimad.github.io/tags/uva/">Uva (9)</a></li>
        
        <li><a href="https://trimad.github.io/tags/vbscript/">VBScript (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/version-management/">Version-Management (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/video/">Video (5)</a></li>
        
        <li><a href="https://trimad.github.io/tags/video-conversion/">Video Conversion (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/visualization/">Visualization (3)</a></li>
        
        <li><a href="https://trimad.github.io/tags/web-administration/">Web-Administration (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/web-development/">Web-Development (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/wifi/">Wifi (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/win32_operatingsystem/">Win32_OperatingSystem (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/windbg/">Windbg (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/windows/">Windows (17)</a></li>
        
        <li><a href="https://trimad.github.io/tags/windows-10/">Windows 10 (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/windows-11/">Windows 11 (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/windows-defender/">Windows-Defender (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/windows-server/">Windows-Server (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/windows-update/">Windows-Update (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/wmic/">Wmic (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/youtube-dl/">Youtube-Dl (1)</a></li>
        
        <li><a href="https://trimad.github.io/tags/yt-dlp/">Yt-Dlp (2)</a></li>
        
    </ul>
</section>
 
            
        </div>

    </div> 

    <footer>
        
            <p>&copy; 2025 Ghostfeed. All rights reserved.</p>


<footer>
    
</footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('post-search');
    const posts = document.querySelectorAll('.post-preview'); 

    if (searchInput && posts.length > 0) {
        searchInput.addEventListener('keyup', function() {
            const searchTerm = searchInput.value.toLowerCase();

            posts.forEach(function(post) {
                const titleElement = post.querySelector('h3 a'); 
                const summaryElement = post.querySelector('p'); 
                const tagsElement = post.querySelector('.tags'); 
                const hrElement = post.nextElementSibling; 

                let textToSearch = '';

                if (titleElement) {
                    textToSearch += titleElement.textContent.toLowerCase() + ' ';
                }
                if (summaryElement) {
                    textToSearch += summaryElement.textContent.toLowerCase() + ' '; 
                }
                if (tagsElement) {
                    textToSearch += tagsElement.textContent.toLowerCase();
                }

                const shouldShow = textToSearch.includes(searchTerm);
                post.style.display = shouldShow ? '' : 'none'; 

                
                if (hrElement && hrElement.tagName === 'HR') {
                    hrElement.style.display = shouldShow ? '' : 'none';
                }
            });
        });
    }
});
</script>

        
    </footer>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.1/p5.js"></script>
    <script src="https://trimad.github.io/js/bg.js"></script>
</body>
</html>
